<!DOCTYPE html>
<!-- saved from url=(0070)https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/ -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><script src="./Understanding glibc malloc – sploitF-U-N_files/client.js.下载" async="" type="text/javascript"></script><script src="./Understanding glibc malloc – sploitF-U-N_files/AdCallAggregator" async=""></script><script async="" src="https://graph.facebook.com/?callback=WPCOMSharing.update_facebook_count&amp;ids=https%3A%2F%2Fsploitfun.wordpress.com%2F2015%2F02%2F10%2Funderstanding-glibc-malloc%2F&amp;_=1527473574025"></script>

<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="profile" href="http://gmpg.org/xfn/11">
<link rel="pingback" href="https://sploitfun.wordpress.com/xmlrpc.php">

<title>Understanding glibc malloc – sploitF-U-N</title>
<link rel="dns-prefetch" href="https://s2.wp.com/">
<link rel="dns-prefetch" href="https://s1.wp.com/">
<link rel="dns-prefetch" href="https://s0.wp.com/">
<link rel="dns-prefetch" href="https://fonts.googleapis.com/">
<link rel="dns-prefetch" href="https://s.pubmine.com/">
<link rel="dns-prefetch" href="https://x.bidswitch.net/">
<link rel="dns-prefetch" href="https://static.criteo.net/">
<link rel="dns-prefetch" href="https://ib.adnxs.com/">
<link rel="dns-prefetch" href="https://aax.amazon-adsystem.com/">
<link rel="dns-prefetch" href="https://bidder.criteo.com/">
<link rel="dns-prefetch" href="https://cas.criteo.com/">
<link rel="dns-prefetch" href="https://gum.criteo.com/">
<link rel="dns-prefetch" href="https://ads.pubmatic.com/">
<link rel="dns-prefetch" href="https://gads.pubmatic.com/">
<link rel="dns-prefetch" href="https://tpc.googlesyndication.com/">
<link rel="dns-prefetch" href="https://ad.doubleclick.net/">
<link rel="dns-prefetch" href="https://googleads.g.doubleclick.net/">
<link rel="dns-prefetch" href="https://www.googletagservices.com/">
<link rel="dns-prefetch" href="https://cdn.switchadhub.com/">
<link rel="dns-prefetch" href="https://delivery.g.switchadhub.com/">
<link rel="dns-prefetch" href="https://delivery.swid.switchadhub.com/">
<link rel="alternate" type="application/rss+xml" title="sploitF-U-N » Feed" href="https://sploitfun.wordpress.com/feed/">
<link rel="alternate" type="application/rss+xml" title="sploitF-U-N » Comments Feed" href="https://sploitfun.wordpress.com/comments/feed/">
<link rel="alternate" type="application/rss+xml" title="sploitF-U-N » Understanding glibc malloc Comments Feed" href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/feed/">
	<script type="text/javascript" async="" src="./Understanding glibc malloc – sploitF-U-N_files/platform.js.下载"></script><script type="text/javascript">
		/* <![CDATA[ */
		function addLoadEvent(func) {
			var oldonload = window.onload;
			if (typeof window.onload != 'function') {
				window.onload = func;
			} else {
				window.onload = function () {
					oldonload();
					func();
				}
			}
		}
		/* ]]> */
	</script>
			<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s0.wp.com\/wp-content\/mu-plugins\/wpcom-smileys\/twemoji\/2\/72x72\/","ext":".png","svgUrl":"https:\/\/s0.wp.com\/wp-content\/mu-plugins\/wpcom-smileys\/twemoji\/2\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/s2.wp.com\/wp-includes\/js\/wp-emoji-release.min.js?m=1516999477h&ver=4.9.7-alpha-43298"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55357,56692,8205,9792,65039],[55357,56692,8203,9792,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);
		</script><script src="./Understanding glibc malloc – sploitF-U-N_files/wp-emoji-release.min.js.下载" type="text/javascript" defer=""></script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel="stylesheet" id="all-css-0-1" href="./Understanding glibc malloc – sploitF-U-N_files/saved_resource" type="text/css" media="all">
<link rel="stylesheet" id="kelly-fonts-css" href="./Understanding glibc malloc – sploitF-U-N_files/css" type="text/css" media="all">
<link rel="stylesheet" id="all-css-2-1" href="./Understanding glibc malloc – sploitF-U-N_files/saved_resource(1)" type="text/css" media="all">
<link rel="stylesheet" id="print-css-3-1" href="./Understanding glibc malloc – sploitF-U-N_files/global-print.css" type="text/css" media="print">
<link rel="stylesheet" id="all-css-4-1" href="./Understanding glibc malloc – sploitF-U-N_files/saved_resource(2)" type="text/css" media="all">
<script type="text/javascript">
/* <![CDATA[ */
var related_posts_js_options = {"post_heading":"h4"};
/* ]]> */
</script>
<script type="text/javascript" src="./Understanding glibc malloc – sploitF-U-N_files/saved_resource(3)"></script>
<link rel="stylesheet" id="all-css-0-2" href="./Understanding glibc malloc – sploitF-U-N_files/style.css" type="text/css" media="all">
<!--[if lt IE 8]>
<link rel='stylesheet' id='highlander-comments-ie7-css'  href='https://s2.wp.com/wp-content/mu-plugins/highlander-comments/style-ie7.css?m=1351637563h&#038;ver=20110606' type='text/css' media='all' />
<![endif]-->
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://sploitfun.wordpress.com/xmlrpc.php?rsd">
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://s1.wp.com/wp-includes/wlwmanifest.xml"> 
<link rel="next" title="Syscalls used by malloc." href="https://sploitfun.wordpress.com/2015/02/11/syscalls-used-by-malloc/">
<meta name="generator" content="WordPress.com">
<link rel="canonical" href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/">
<link rel="shortlink" href="https://wp.me/p5Jw8b-3">
<link rel="alternate" type="application/json+oembed" href="https://public-api.wordpress.com/oembed/?format=json&amp;url=https%3A%2F%2Fsploitfun.wordpress.com%2F2015%2F02%2F10%2Funderstanding-glibc-malloc%2F&amp;for=wpcom-auto-discovery"><link rel="alternate" type="application/xml+oembed" href="https://public-api.wordpress.com/oembed/?format=xml&amp;url=https%3A%2F%2Fsploitfun.wordpress.com%2F2015%2F02%2F10%2Funderstanding-glibc-malloc%2F&amp;for=wpcom-auto-discovery">
<!-- Jetpack Open Graph Tags -->
<meta property="og:type" content="article">
<meta property="og:title" content="Understanding glibc malloc">
<meta property="og:url" content="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/">
<meta property="og:description" content="I always got fascinated by heap memory. Questions such as How heap memory is obtained from kernel? How efficiently memory is managed? Is it managed by kernel or by library or by application itself?…">
<meta property="article:published_time" content="2015-02-10T10:58:29+00:00">
<meta property="article:modified_time" content="2015-07-06T10:00:24+00:00">
<meta property="og:site_name" content="sploitF-U-N">
<meta property="og:image" content="https://docs.google.com/drawings/d/1Kf_eg7uB2mRjSOasTc4dIu5fuBpTAK0GxbnKVTkZd0Y/pub?w=1217&amp;h=865">
<meta property="og:locale" content="en_US">
<meta name="twitter:site" content="@wordpressdotcom">
<meta name="twitter:text:title" content="Understanding glibc malloc">
<meta name="twitter:image" content="https://docs.google.com/drawings/d/1367fdYcRTvkyfZ_s27yg6oJp5KYsVAuYqPf8szbRNc0/pub?w=240">
<meta name="twitter:card" content="summary">
<meta property="fb:app_id" content="249643311490">
<meta property="article:publisher" content="https://www.facebook.com/WordPresscom">

<!-- End Jetpack Open Graph Tags -->
<link rel="shortcut icon" type="image/x-icon" href="https://s1.wp.com/i/favicon.ico" sizes="16x16 24x24 32x32 48x48">
<link rel="icon" type="image/x-icon" href="https://s1.wp.com/i/favicon.ico" sizes="16x16 24x24 32x32 48x48">
<link rel="apple-touch-icon-precomposed" href="https://s2.wp.com/i/webclip.png">
<link rel="openid.server" href="https://sploitfun.wordpress.com/?openidserver=1">
<link rel="openid.delegate" href="https://sploitfun.wordpress.com/">
<link rel="search" type="application/opensearchdescription+xml" href="https://sploitfun.wordpress.com/osd.xml" title="sploitF-U-N">
<link rel="search" type="application/opensearchdescription+xml" href="https://s1.wp.com/opensearch.xml" title="WordPress.com">
<meta name="theme-color" content="#ffffff">
		<style type="text/css">
			.recentcomments a {
				display: inline !important;
				padding: 0 !important;
				margin: 0 !important;
			}

			table.recentcommentsavatartop img.avatar, table.recentcommentsavatarend img.avatar {
				border: 0px;
				margin: 0;
			}

			table.recentcommentsavatartop a, table.recentcommentsavatarend a {
				border: 0px !important;
				background-color: transparent !important;
			}

			td.recentcommentsavatarend, td.recentcommentsavatartop {
				padding: 0px 0px 1px 0px;
				margin: 0px;
			}

			td.recentcommentstextend {
				border: none !important;
				padding: 0px 0px 2px 10px;
			}

			.rtl td.recentcommentstextend {
				padding: 0px 10px 2px 0px;
			}

			td.recentcommentstexttop {
				border: none;
				padding: 0px 0px 0px 10px;
			}

			.rtl td.recentcommentstexttop {
				padding: 0px 10px 0px 0px;
			}
		</style>
		<meta name="application-name" content="sploitF-U-N"><meta name="msapplication-window" content="width=device-width;height=device-height"><meta name="msapplication-task" content="name=Subscribe;action-uri=https://sploitfun.wordpress.com/feed/;icon-uri=https://s1.wp.com/i/favicon.ico"><meta name="msapplication-task" content="name=Sign up for a free blog;action-uri=http://wordpress.com/signup/;icon-uri=https://s1.wp.com/i/favicon.ico"><meta name="msapplication-task" content="name=WordPress.com Support;action-uri=http://support.wordpress.com/;icon-uri=https://s1.wp.com/i/favicon.ico"><meta name="msapplication-task" content="name=WordPress.com Forums;action-uri=http://forums.wordpress.com/;icon-uri=https://s1.wp.com/i/favicon.ico"><meta name="description" content="I always got fascinated by heap memory. Questions such as How heap memory is obtained from kernel? How efficiently memory is managed? Is it managed by kernel or by library or by application itself? Can heap memory be exploited? were in my mind for quite some time. But only recently I got time to understand about it.…">
		<script type="text/javascript">
		var __ATA_PP = { pt: 1, ht: 0, tn: 'kelly', amp: false, siteid: 8982, consent: 0 };
		var __ATA = __ATA || {};
		__ATA.cmd = __ATA.cmd || [];
		__ATA.criteo = __ATA.criteo || {};
		__ATA.criteo.cmd = __ATA.criteo.cmd || [];
		</script>
		<script type="text/javascript" src="./Understanding glibc malloc – sploitF-U-N_files/head.js.下载" async=""></script><link rel="amphtml" href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/amp/"><style type="text/css" id="syntaxhighlighteranchor"></style>
<script type="text/javascript">
	window.google_analytics_uacct = "UA-52447-2";
</script>

<script type="text/javascript">
	var _gaq = _gaq || [];
	_gaq.push(['_setAccount', 'UA-52447-2']);
	_gaq.push(['_setDomainName', 'wordpress.com']);
	_gaq.push(['_initData']);
	_gaq.push(['_trackPageview']);

	(function() {
		var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ga);
	})();
</script><script type="text/javascript" async="" src="./Understanding glibc malloc – sploitF-U-N_files/ga.js.下载"></script>
<script type="text/javascript" async="" src="./Understanding glibc malloc – sploitF-U-N_files/ConsentA.js.下载"></script><link rel="stylesheet" type="text/css" id="gravatar-card-css" href="./Understanding glibc malloc – sploitF-U-N_files/hovercard.css"><link rel="stylesheet" type="text/css" id="gravatar-card-services-css" href="./Understanding glibc malloc – sploitF-U-N_files/services.css"><script type="text/javascript" async="" src="./Understanding glibc malloc – sploitF-U-N_files/saved_resource(4)"></script><script src="./Understanding glibc malloc – sploitF-U-N_files/gshowad.js.下载"></script><script type="text/javascript" async="" src="./Understanding glibc malloc – sploitF-U-N_files/saved_resource(5)"></script><script src="./Understanding glibc malloc – sploitF-U-N_files/outstream.js.下载" async=""></script><style type="text/css">.iowo-adv {overflow: hidden;}.iowo-adv__header {font-family: "Helvetica", Arial, sans-serif !important;font-size: 11.5px !important;text-align: center;position: relative;padding: 5px 0px;letter-spacing: 0.3px !important;font-weight: 300 !important;text-transform: uppercase;color: #aaa}.iowo-adv__close-icon {width: 24px;height: 24px;position: absolute;right: 10px;top: 34px;z-index:10;cursor: pointer;background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAB3RJTUUH4gMQDS4lyDpzXgAAAKlJREFUWMPVV1sOgCAMo9yZU3Bo/THGRKaylTXuF9YW9mCgtbaVw3rvKAl25azWQgb5TcBqESNsWAvscFgceNuwkvy8gZUi3jAx68AkHwpgifiKgShA1BcsIK8PmKfxCKZdqTdkYCRVJF/CmT2ymYoBo7Yj5UprMN6GVYvY/hUCaRJKy1DaiKStWPoYSZ9j6UAiHcmkQ6l0LJd+TDLIn0TULHILu2aRWxw7NqDQ4pqt7KcAAAAASUVORK5CYII=");background-size: contain;}.iowo-adv__close-icon_touch {left: 10px;}.iowo-adv__sound-icon {width: 32px;cursor: pointer;height: 32px;position: absolute;bottom:12px;right:5px;}.iowo-adv__sound-icon_on {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4QYcDigM2jawiwAAAbhJREFUWMPtl7FLHFEQxr+ZtwTytLDwmjSnhf+AYrpUBwGvS7F2YqFNQNjieCnsTlPscdxdZ2MVCORIEewMwf/AlEkRCRaSKqQMCrnbGZtVLPRye2/dJcSpdos33292vjfvLfAQ/3tQHkkajcYqM68YY3bjOD7NsjbwFXfOhSLyDgAPBgMBsJFlPXuK10TkLTNf5ZnKmoM9PvuSqh4w8yOfInjCyhcAHBLRtG8LeQLxJyLyiZkreRg4E0AURTOq+pGZ5/LahsEodwN4A+Dxfc6BUdsw9BF3zkWqOq2q+51O5+ckLWDP4p4R0Wtm/uqcW7wvkXFiVkT6YRiaQgGGw+Gaqn4AAGZeqFarTwsF6PV6F0R0eH3oEFUKBXDO1QBsX70bY74U7YGXAObT5/5dp2QRJuyLyGbmOaCq50Re14XYGPPqb/eDOwGCINhJkkRvHrGqOkNEtXHU2+32Z69JGMfxdwDrt5hrL+1vLpHZA9baLQDvSwNoNptirV0DcFQKQArxx1r7AsBxKQApxO8kSeoi8q0UAADodru/giB4LiI/0pl/UigAALRarTMiWhaRurV25+FX65+LSxNniSadskJNAAAAAElFTkSuQmCC");}.iowo-adv__sound-icon_off {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEwAACxMBAJqcGAAAAdBJREFUWIXt1b9r1GAcx/HP840u94jo6mD/Aae24I9NHZSCi5NDO5TO7fLkCTgdt15y4C6IdHFwEpxscRHc1dHB0UFBOvToks/Xxch53j3JExNB6XcMz+X1Ti5PApzO/zLD4fBMm99JF7hzbm86nZ6kafp02Rrv/apz7mrnAd77LRF5BCBR1fvLcJKHIvIqy7JrnQV47zdIPgFgAEBEfjvfDH4RwHmSW50EZFl2g+RzEfn535P8FsABYN9au/vHAc65K2VZvhSRwQz+JUmSjRA+GAy2R6MRZ89lWuArAN6KyKU5/PZ4PP4QgwNAcOs4524ZYy7/UmzMQwBLcefcGsmDJjgQuAPe+5sAXocCF+EAGuNA4BlQ1ZW+8WDA38BbBXSJRwfU4SSnMThQswvqcBE5BHChWiMiGoMDDe9AE7zt1Ab0idcG9I0HA0i+6xsHGn4LvPfrAA4a4Md5np+LCah9BuZxVX1G8mMM0jpgwZXvW2s3AdwB8LnXgEV49ZKZTCafVPUuyaNeAkJ4taYoivcico/kSacBTfBq8jx/Y4x5AKD8caicXxMdoKpnSSZ1eDVFUbwwxuwA+Kqqj2MDFm7DNE2vA9i01u7GvttP55+b71U6NuXe6u9vAAAAAElFTkSuQmCC");}.iowo-adv__timer {position: absolute;bottom:5px;left:5px;min-width: 60px;padding: 3px;color: #aaaaaa;border-radius: 5px;font-family: sans-serif;text-align: center;background-color:black;z-index:10;}.iowo-timeline {position: absolute;bottom:0;left:0;width: 100%;height: 5px;background-color: rgba(0, 0, 0, 0.2);}.iowo-timeline__runner {position: relative;height: 5px;background-color: red;-moz-transition: .5s;-ms-transition: .5s;-o-transition: .5s;-webkit-transition: .5s;transition: .5s;transition-property: max-width;}</style><script type="text/javascript" charset="UTF-8" src="./Understanding glibc malloc – sploitF-U-N_files/ima3.js.下载"></script><link rel="preload" href="./Understanding glibc malloc – sploitF-U-N_files/f.txt" as="script"><script type="text/javascript" src="./Understanding glibc malloc – sploitF-U-N_files/f.txt"></script><iframe src="./Understanding glibc malloc – sploitF-U-N_files/showad.html" height="0" width="0" marginwidth="0" marginheight="0" scrolling="no" frameborder="0" style="height: 0px; width: 0px; border: 0px;"></iframe></head>

<body class="post-template-default single single-post postid-3 single-format-standard mp6 customizer-styles-applied highlander-enabled highlander-light">
<div id="page" class="hfeed site">
			<header id="masthead" class="site-header" role="banner">
		<div class="header-background"></div>
		<div class="site-branding">
			<h1 class="site-title"><a href="https://sploitfun.wordpress.com/" rel="home">sploitF-U-N</a></h1>
			<h2 class="site-description"></h2>
		</div>

		<nav id="site-navigation" class="main-navigation" role="navigation">
			<h1 class="menu-toggle">Menu</h1>
			<a class="skip-link screen-reader-text" href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/#content">Skip to content</a>

			<div class="nav-menu"><ul class=" nav-menu">
<li><a href="https://sploitfun.wordpress.com/">Home</a></li><li class="page_item page-item-35"><a href="https://sploitfun.wordpress.com/archives/">Archives</a></li>
<li class="page_item page-item-37"><a href="https://sploitfun.wordpress.com/about-2/">Me</a></li>
</ul></div>
		</nav><!-- #site-navigation -->
	</header><!-- #masthead -->

	<div id="content" class="site-content">

	<div id="primary" class="content-area">
		<main id="main" class="site-main" role="main">

		
			
<article id="post-3" class="post-3 post type-post status-publish format-standard hentry category-uncategorized tag-glibc tag-heap tag-malloc tag-ptmalloc">
		<header class="entry-header">
					<h1 class="entry-title">Understanding glibc malloc</h1>
		
		<div class="entry-meta">
			<span class="posted-on">Posted on <a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/" rel="bookmark"><time class="entry-date published" datetime="2015-02-10T10:58:29+00:00">February 10, 2015</time><time class="updated" datetime="2015-07-06T10:00:24+00:00">July 6, 2015</time></a></span><span class="byline"> by <span class="author vcard"><a class="url fn n" href="https://sploitfun.wordpress.com/author/sploitfun/">sploitfun</a></span></span>		</div><!-- .entry-meta -->
	</header><!-- .entry-header -->

	<div class="entry-content">
		<p>I always got fascinated by heap memory. Questions such as</p>
<blockquote><p>How heap memory is&nbsp;obtained from kernel?<br>
How efficiently memory is managed?<br>
Is it managed by kernel or by&nbsp;library or by application itself?<br>
Can heap memory be exploited?</p></blockquote>
<p>were in my mind for quite some time. But only recently I got time to understand about it. So here I would like to share my fascination turned knowledge!! Out there in the wild, many memory allocators are available:</p>
<ul>
<li>dlmalloc – General purpose allocator</li>
<li>ptmalloc2 – glibc</li>
<li>jemalloc – FreeBSD and Firefox</li>
<li>tcmalloc – Google</li>
<li>libumem – Solaris</li>
<li>…</li>
</ul>
<p>Every memory allocator claims they are fast, scalable and memory efficient!!&nbsp;But not all allocators can be suited well for our application. Memory hungry application’s performance largely depends on memory allocator performance. In this post, I will only talk about ‘glibc malloc’ memory allocator. In future, I am hoping to&nbsp;cover up other memory allocators. Throughout this post, for better understanding of ‘glibc malloc’, I will link its <a href="https://sourceware.org/ml/libc-alpha/2014-09/msg00088.html" target="_blank">recent</a> source code.&nbsp;So buckle up, lets get started with glibc malloc!!</p>
<p><span style="text-decoration:underline;"><em>History</em></span>:&nbsp;<a href="http://www.malloc.de/en/" target="_blank">ptmalloc2</a> was forked from <a href="http://g.oswego.edu/dl/html/malloc.html" target="_blank">dlmalloc</a>. After fork, threading support was added to it&nbsp;and&nbsp;got released in 2006. After its official release, ptmalloc2 got integrated into glibc source code. Once its integration,&nbsp;code changes were made directly to glibc malloc source code itself. Hence there could be lot of changes between ptmalloc2 and glibc’s malloc implementation.</p>
<p><strong>System</strong> <strong>Calls</strong>:<strong>&nbsp;</strong>As seen in <a href="https://sploitfun.wordpress.com/2015/02/11/syscalls-used-by-malloc/" target="_blank">this</a> post&nbsp;malloc internally invokes either <a href="http://man7.org/linux/man-pages/man2/sbrk.2.html" target="_blank">brk</a> or <a href="http://man7.org/linux/man-pages/man2/mmap.2.html" target="_blank">mmap</a> syscall.</p>
<p><strong>Threading</strong>:&nbsp;During early days of linux, dlmalloc was used as the default memory allocator. But later due to ptmalloc2’s threading support, it&nbsp;became the default memory allocator for linux. Threading support helps in improving memory allocator performance and hence application performance. In dlmalloc when two threads call malloc at the same time ONLY one thread can enter the critical section, since freelist data structure is shared among all the available threads. Hence memory allocation takes time in multi threaded applications, resulting in performance degradation. While in ptmalloc2, when two threads call malloc at the same time memory is allocated immediately since each thread maintains a separate heap segment and hence freelist data structures maintaining those heaps are also separate. This act of maintaining separate heap and freelist&nbsp;data structures for each thread&nbsp;is called <strong>per thread arena</strong>.</p>
<p><span style="text-decoration:underline;"><em>Example</em></span>:</p>
<pre>/* Per thread arena example. */
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;pthread.h&gt;
#include &lt;unistd.h&gt;
#include &lt;sys/types.h&gt;

void* threadFunc(void* arg) {
        printf("Before malloc in thread 1\n");
        getchar();
        char* addr = (char*) malloc(1000);
        printf("After malloc and before free in thread 1\n");
        getchar();
        free(addr);
        printf("After free in thread 1\n");
        getchar();
}

int main() {
        pthread_t t1;
        void* s;
        int ret;
        char* addr;

        printf("Welcome to per thread arena example::%d\n",getpid());
        printf("Before malloc in main thread\n");
        getchar();
        addr = (char*) malloc(1000);
        printf("After malloc and before free in main thread\n");
        getchar();
        free(addr);
        printf("After free in main thread\n");
        getchar();
        ret = pthread_create(&amp;t1, NULL, threadFunc, NULL);
        if(ret)
        {
                printf("Thread creation error\n");
                return -1;
        }
        ret = pthread_join(t1, &amp;s);
        if(ret)
        {
                printf("Thread join error\n");
                return -1;
        }
        return 0;
}</pre>
<p><span style="text-decoration:underline;"><em>Output Analysis</em></span>:</p>
<p><em>Before malloc in main thread:</em> In the below output we can see that there is NO heap segment yet and no per thread stack too since thread1 is not yet created.</p>
<pre>sploitfun@sploitfun-VirtualBox:~/<span class="skimlinks-unlinked">ptmalloc.ppt/mthread</span>$ ./mthread 
Welcome to per thread arena example::6501
Before malloc in main thread
...
sploitfun@sploitfun-VirtualBox:~/<span class="skimlinks-unlinked">ptmalloc.ppt/mthread</span>$ cat /proc/6501/maps
08048000-08049000 r-xp 00000000 08:01 539625     /home/sploitfun/<span class="skimlinks-unlinked">ptmalloc.ppt/mthread/mthread</span>
08049000-0804a000 r--p 00000000 08:01 539625     /home/sploitfun/<span class="skimlinks-unlinked">ptmalloc.ppt/mthread/mthread</span>
0804a000-0804b000 rw-p 00001000 08:01 539625     /home/sploitfun/<span class="skimlinks-unlinked">ptmalloc.ppt/mthread/mthread</span>
b7e05000-b7e07000 rw-p 00000000 00:00 0 
...
sploitfun@sploitfun-VirtualBox:~/<span class="skimlinks-unlinked">ptmalloc.ppt/mthread</span>$</pre>
<p><em>After malloc&nbsp;in main thread:</em> In the below output we can see that heap segment is created and its lies just above the data segment (0804b000-0806c000), this shows heap memory is created by increasing program break location ( ie) using <a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L2458" target="_blank"><strong>brk</strong></a> syscall). Also do note that eventhough user requested only 1000 bytes, heap memory of size <a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L2429" target="_blank">132 KB</a> is created. This contiguous region of heap memory is called <strong>arena</strong>. Since this arena is created by main thread its called&nbsp;<a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L1740" target="_blank"><strong>main arena</strong></a>.&nbsp;Further allocation requests keeps using this&nbsp;arena&nbsp;until it runs out of free space. When <a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L3788" target="_blank">arena&nbsp;runs out of free space</a>, it can <a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L2458" target="_blank">grow</a> by increasing program break location (After growing top chunk’s <a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L2521" target="_blank">size</a> is adjusted to include the extra space). Similarly arena can also <a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L4044" target="_blank">shrink</a> when there is lot of free space on top chunk.</p>
<p><span style="text-decoration:underline;"><em>NOTE</em></span>: Top chunk is the top most chunk of an arena. For further details about it, see “Top Chunk” section below.</p>
<pre>sploitfun@sploitfun-VirtualBox:~/<span class="skimlinks-unlinked">ptmalloc.ppt/mthread</span>$ ./mthread 
Welcome to per thread arena example::6501
Before malloc in main thread
After malloc and before free in main thread
...
sploitfun@sploitfun-VirtualBox:~/lsploits/hof/<span class="skimlinks-unlinked">ptmalloc.ppt/mthread</span>$ cat /proc/6501/maps
08048000-08049000 r-xp 00000000 08:01 539625     /home/sploitfun/<span class="skimlinks-unlinked">ptmalloc.ppt/mthread/mthread</span>
08049000-0804a000 r--p 00000000 08:01 539625     /home/sploitfun/<span class="skimlinks-unlinked">ptmalloc.ppt/mthread/mthread</span>
0804a000-0804b000 rw-p 00001000 08:01 539625     /home/sploitfun/<span class="skimlinks-unlinked">ptmalloc.ppt/mthread/mthread</span>
<strong>0804b000-0806c000 rw-p 00000000 00:00 0          [heap]
</strong>b7e05000-b7e07000 rw-p 00000000 00:00 0 
...
sploitfun@sploitfun-VirtualBox:~/<span class="skimlinks-unlinked">ptmalloc.ppt/mthread</span>$</pre>
<p><em>After free in main thread:</em> In the below output we can see that when allocated memory region is freed, memory behind it doesnt get released to the operating system immediately. Allocated memory region (of size 1000 bytes) is <a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L4017" target="_blank">released</a>&nbsp;only to ‘glibc malloc’ library, which adds this freed block&nbsp;to main arenas bin (In glibc malloc, freelist datastructures are referred as bins). Later when user requests memory, ‘glibc malloc’&nbsp;doesnt get new heap memory from kernel, instead it will try to <a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L3376" target="_blank">find</a> a free block in bin. And only when no free block exists, it&nbsp;obtains memory from kernel.</p>
<pre>sploitfun@sploitfun-VirtualBox:~/<span class="skimlinks-unlinked">ptmalloc.ppt/mthread</span>$ ./mthread 
Welcome to per thread arena example::6501
Before malloc in main thread
After malloc and before free in main thread
After free in main thread
...
sploitfun@sploitfun-VirtualBox:~/lsploits/hof/<span class="skimlinks-unlinked">ptmalloc.ppt/mthread</span>$ cat /proc/6501/maps
08048000-08049000 r-xp 00000000 08:01 539625     /home/sploitfun/<span class="skimlinks-unlinked">ptmalloc.ppt/mthread/mthread</span>
08049000-0804a000 r--p 00000000 08:01 539625     /home/sploitfun/<span class="skimlinks-unlinked">ptmalloc.ppt/mthread/mthread</span>
0804a000-0804b000 rw-p 00001000 08:01 539625     /home/sploitfun/<span class="skimlinks-unlinked">ptmalloc.ppt/mthread/mthread</span>
<strong>0804b000-0806c000 rw-p 00000000 00:00 0          [heap]
</strong>b7e05000-b7e07000 rw-p 00000000 00:00 0 
...
sploitfun@sploitfun-VirtualBox:~/<span class="skimlinks-unlinked">ptmalloc.ppt/mthread</span>$</pre>
<p><em>Before malloc in thread1:</em> In the below output we can see that there is NO thread1 heap segment but now thread1’s per thread stack is created.</p>
<pre>sploitfun@sploitfun-VirtualBox:~/<span class="skimlinks-unlinked">ptmalloc.ppt/mthread</span>$ ./mthread 
Welcome to per thread arena example::6501
Before malloc in main thread
After malloc and before free in main thread
After free in main thread
Before malloc in thread 1
...
sploitfun@sploitfun-VirtualBox:~/<span class="skimlinks-unlinked">ptmalloc.ppt/mthread</span>$ cat /proc/6501/maps
08048000-08049000 r-xp 00000000 08:01 539625     /home/sploitfun/<span class="skimlinks-unlinked">ptmalloc.ppt/mthread/mthread</span>
08049000-0804a000 r--p 00000000 08:01 539625     /home/sploitfun/<span class="skimlinks-unlinked">ptmalloc.ppt/mthread/mthread</span>
0804a000-0804b000 rw-p 00001000 08:01 539625     /home/sploitfun/<span class="skimlinks-unlinked">ptmalloc.ppt/mthread/mthread</span>
0804b000-0806c000 rw-p 00000000 00:00 0          [heap]
b7604000-b7605000 ---p 00000000 00:00 0 
<strong>b7605000-b7e07000 rw-p 00000000 00:00 0          [stack:6594]
</strong>...
sploitfun@sploitfun-VirtualBox:~/<span class="skimlinks-unlinked">ptmalloc.ppt/mthread</span>$</pre>
<p><em>After malloc in thread1</em>: In the below output we can see that thread1’s heap segment is created. And its lies in memory mapping segment region (b7500000-b7521000 whose size is 132 KB) and hence this shows heap memory is created using <a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/arena.c#L546https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/arena.c#L546" target="_blank"><strong>mmap</strong></a> syscall unlike main thread (which uses sbrk). Again here, eventhough user requested only 1000 bytes, heap memory of size <a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/arena.c#L546" target="_blank">1 MB</a>&nbsp;is mapped to process address space. Out of these 1 MB, only for <a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/arena.c#L573" target="_blank">132KB</a> read-write permission is set and this becomes the heap memory for this thread. This contiguous region of memory (132 KB) is&nbsp;called&nbsp;<a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/arena.c#L736" target="_blank"><strong>thread&nbsp;arena</strong></a>.</p>
<p><span style="text-decoration:underline;"><em>NOTE</em></span>: When user request size is more than 128 KB ( lets say malloc(132*1024)) and when there is not enough space in an arena to satisfy user request, memory is allocated using mmap syscall (and NOT using sbrk) irrespective of whether a request is made from main arena or thread arena.</p>
<pre>sploitfun@sploitfun-VirtualBox:~/<span class="skimlinks-unlinked">ptmalloc.ppt/mthread</span>$ ./mthread 
Welcome to per thread arena example::6501
Before malloc in main thread
After malloc and before free in main thread
After free in main thread
Before malloc in thread 1
After malloc and before free in thread 1
...
sploitfun@sploitfun-VirtualBox:~/<span class="skimlinks-unlinked">ptmalloc.ppt/mthread</span>$ cat /proc/6501/maps
08048000-08049000 r-xp 00000000 08:01 539625     /home/sploitfun/<span class="skimlinks-unlinked">ptmalloc.ppt/mthread/mthread</span>
08049000-0804a000 r--p 00000000 08:01 539625     /home/sploitfun/<span class="skimlinks-unlinked">ptmalloc.ppt/mthread/mthread</span>
0804a000-0804b000 rw-p 00001000 08:01 539625     /home/sploitfun/<span class="skimlinks-unlinked">ptmalloc.ppt/mthread/mthread</span>
0804b000-0806c000 rw-p 00000000 00:00 0          [heap]
<strong>b7500000-b7521000 rw-p 00000000 00:00 0 
b7521000-b7600000 ---p 00000000 00:00 0 
</strong>b7604000-b7605000 ---p 00000000 00:00 0 
b7605000-b7e07000 rw-p 00000000 00:00 0          [stack:6594]
...
sploitfun@sploitfun-VirtualBox:~/<span class="skimlinks-unlinked">ptmalloc.ppt/mthread</span>$</pre>
<p><em>After free in thread1</em>:&nbsp;In the below output we can see that freeing allocated memory region doesnt release heap memory to the operating system. Instead&nbsp;allocated memory region (of size 1000 bytes) is <a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L4017" target="_blank">released</a> to ‘glibc malloc’, which adds this freed block&nbsp;to its thread arenas&nbsp;bin.</p>
<pre>sploitfun@sploitfun-VirtualBox:~/<span class="skimlinks-unlinked">ptmalloc.ppt/mthread</span>$ ./mthread 
Welcome to per thread arena example::6501
Before malloc in main thread
After malloc and before free in main thread
After free in main thread
Before malloc in thread 1
After malloc and before free in thread 1
After free in thread 1
...
sploitfun@sploitfun-VirtualBox:~/<span class="skimlinks-unlinked">ptmalloc.ppt/mthread</span>$ cat /proc/6501/maps
08048000-08049000 r-xp 00000000 08:01 539625     /home/sploitfun/<span class="skimlinks-unlinked">ptmalloc.ppt/mthread/mthread</span>
08049000-0804a000 r--p 00000000 08:01 539625     /home/sploitfun/<span class="skimlinks-unlinked">ptmalloc.ppt/mthread/mthread</span>
0804a000-0804b000 rw-p 00001000 08:01 539625     /home/sploitfun/<span class="skimlinks-unlinked">ptmalloc.ppt/mthread/mthread</span>
0804b000-0806c000 rw-p 00000000 00:00 0          [heap]
<strong>b7500000-b7521000 rw-p 00000000 00:00 0 
</strong>b7521000-b7600000 ---p 00000000 00:00 0 
b7604000-b7605000 ---p 00000000 00:00 0 
b7605000-b7e07000 rw-p 00000000 00:00 0          [stack:6594]
...
sploitfun@sploitfun-VirtualBox:~/<span class="skimlinks-unlinked">ptmalloc.ppt/mthread</span>$</pre>
<p><strong>Arena:</strong></p>
<p><span style="text-decoration:underline;"><em>Number of arena’s</em></span>: In above example, we saw main thread contains main arena and thread 1 contains its own thread arena. So can there be a one to one mapping&nbsp;between threads and arena, irrespective of number of threads? Certainly not. An insane application can contain more number of threads (than number of cores), in such a case, having one arena per thread becomes bit expensive and useless. Hence for this reason,&nbsp;application’s <a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/arena.c#L847" target="_blank">arena limit is based on number of cores</a> present in the system.</p>
<pre>For <a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L1754" target="_blank">32 bit</a> systems:
     Number of arena = 2 * number of cores.
For <a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L1754" target="_blank">64 bit</a> systems:
     Number of arena = 8 * number of cores.</pre>
<p><span style="text-decoration:underline;"><em>Multiple Arena</em></span>:</p>
<p>Example: Lets say a multithreaded application (4 threads – Main thread + 3 user threads) runs on a 32 bit system which contains 1 core. Here no of threads (4) &gt; 2*no of cores (2). Hence in such a case, ‘glibc malloc’ makes sure that multiple arenas are shared among all available threads. But how its shared?</p>
<ul>
<li>When main thread, calls malloc for the first time <a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L1740" target="_blank">already created main arena</a> is used without any contention.</li>
<li>When thread 1 and thread 2 calls malloc for the first time, <a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/arena.c#L870" target="_blank">a new arena is created</a>&nbsp;for them and its used without any contention. Until this point threads and arena have one-to-one mapping.</li>
<li>When&nbsp;thread 3 calls malloc for the first time,&nbsp;number of arena limit is <a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/arena.c#L847" target="_blank">calculated</a>. Here arena limit is crossed, hence try <a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/arena.c#L875" target="_blank">reusing</a> existing arena’s (Main arena or Arena 1 or Arena 2)</li>
<li>&nbsp;Reuse:
<ul>
<li><a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/arena.c#L810" target="_blank">Once loop over </a>the available arenas, while looping <a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/arena.c#L805" target="_blank">try</a> to lock&nbsp;that arena.</li>
<li>If locked successfully (lets say main arena is locked successfully), <a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/arena.c#L826" target="_blank">return</a> that arena to the user.</li>
<li>If no arena is found free,&nbsp;<a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/arena.c#L819" target="_blank">block</a> for the arena next in line.</li>
</ul>
</li>
<li>Now when thread 3 calls malloc (second time), malloc will <a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L2884" target="_blank">try to use last accessed arena</a> (main arena). If main arena is free its used else thread3 is blocked until main arena gets freed. Thus now main arena is shared among main thread and thread 3.</li>
</ul>
<p><span style="text-decoration:underline;"><em>Multiple Heaps</em></span><strong>:</strong></p>
<p>Primarily below three datastructures are found in ‘glibc malloc’ source code:</p>
<p><a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/arena.c#L59" target="_blank"><strong>heap_info</strong></a> – Heap Header – A single thread arena can have multiple heaps. Each heap has its own header. Why multiple heaps needed? To begin with every thread arena contains ONLY one heap, but when this heap segment runs out of space, new heap (non contiguous region) gets&nbsp;mmap’d to this arena.<br>
<a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L1671" target="_blank"><strong>malloc_state</strong></a> – Arena Header – A single thread arena can have multiple heaps, but for&nbsp;all those heaps only&nbsp;a single arena header exists. Arena header&nbsp;contains&nbsp;information about bins, top chunk, last remainder chunk…<br>
<strong><a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L1108" target="_blank">malloc_chunk</a>&nbsp;</strong>– Chunk Header – A heap is divided into many chunks&nbsp;based on user requests. Each of those chunks has its own chunk header.</p>
<p><span style="text-decoration:underline;"><em>NOTE</em></span>:</p>
<ul>
<li>Main arena dont have multiple heaps and hence no heap_info structure. When main arena runs out of space, sbrk’d heap segment is extended (contiguous region) until it bumps into memory mapping segment.</li>
<li>Unlike thread arena, main arena’s arena header isnt&nbsp;part of&nbsp;sbrk’d heap segment. Its a <a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L1740" target="_blank">global variable</a> and hence its found in <span class="skimlinks-unlinked">libc.so’s</span> data segment.</li>
</ul>
<p>Pictorial view of main arena and thread arena (single heap segment):</p>
<p><img class="alignnone" src="./Understanding glibc malloc – sploitF-U-N_files/sQj8dLRIGudo7SihLqOIzvQ.png" alt="" width="960" height="720"></p>
<p>Pictorial view of thread arena (multiple&nbsp;heap segment’s):</p>
<p><img class=" alignnone" src="./Understanding glibc malloc – sploitF-U-N_files/s-BNoTUisiIgfyaQBplNGXw.png" alt="" width="960" height="720"></p>
<p><strong>Chunk</strong>: A chunk found inside a heap segment can be one of the below types:</p>
<ul>
<li>Allocated chunk</li>
<li>Free chunk</li>
<li>Top chunk</li>
<li>Last Remainder chunk</li>
</ul>
<p><span style="text-decoration:underline;"><em>Allocated chunk</em></span>:</p>
<p><img class="alignnone" src="./Understanding glibc malloc – sploitF-U-N_files/sgdvgHrPBiC2iIzL6lJS79w.png" alt="" width="962" height="681"></p>
<p><a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L1110" target="_blank">prev_size</a>: If the previous chunk is free, this field contains the size of previous chunk. Else if previous chunk is allocated, this field contains previous chunk’s user data.<br>
<a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L1111" target="_blank">size</a>: This field contains the size of this allocated chunk. Last 3 bits of this field contains flag information.</p>
<ul>
<li><a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L1267" target="_blank">PREV_INUSE</a>&nbsp;(P) – This bit is set when previous chunk is allocated.</li>
<li><a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L1274" target="_blank">IS_MMAPPED</a>&nbsp;(M) – This bit is set when chunk is mmap’d.</li>
<li><a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L1283" target="_blank">NON_MAIN_ARENA</a>&nbsp;(N) – This bit is set when this chunk belongs to a thread arena.</li>
</ul>
<p><span style="text-decoration:underline;"><em>NOTE</em></span>:</p>
<ul>
<li>Other fields of malloc_chunk (like fd, bk) is NOT used for allocated chunk. Hence in place of these fields user data is stored.</li>
<li>User requested size is <a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L1254" target="_blank">converted</a> into usable size (internal representation size) since some extra space is needed for storing malloc_chunk and also for alignment purposes. Conversion takes place&nbsp;in such a way that last 3 bits of usable size&nbsp;is never set&nbsp;and hence its&nbsp;used for storing flag information.</li>
</ul>
<p><span style="text-decoration:underline;"><em>Free Chunk</em></span>:</p>
<p><img class="alignnone" src="./Understanding glibc malloc – sploitF-U-N_files/suji1bPhSjf2gi-kqve8MtA.png" alt="" width="940" height="668"></p>
<p><a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L1110" target="_blank">prev_size</a>: No two free chunks can be adjacent together. When both the chunks are free, its gets combined into one single free chunk. Hence always previous chunk to this freed chunk would be allocated and therefore&nbsp;prev_size contains previous chunk’s user data.<br>
<a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L1111" target="_blank">size</a>: This field contains the size of this free chunk.<br>
<a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L1113" target="_blank">fd</a>: Forward pointer – Points to next chunk in the same bin (and NOT to the next chunk present in physical memory).<br>
<a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L1114" target="_blank">bk</a>: Backward pointer – Points to previous chunk in the same bin (and NOT to the previous chunk present in physical memory).</p>
<p><strong>Bins</strong>: Bins are the freelist datastructures. They&nbsp;are used to hold free chunks. Based on chunk sizes, different bins are available:</p>
<ul>
<li>Fast bin</li>
<li>Unsorted bin</li>
<li>Small bin</li>
<li>Large bin</li>
</ul>
<p>Datastructures used to hold these bins are:</p>
<p><a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L1680" target="_blank"><strong>fastbinsY</strong></a>: This array hold fast bins.<br>
<a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L1689" target="_blank"><strong>bins</strong></a>: This array hold unsorted, small and large bins. Totally there are 126 bins and its divided&nbsp;as follows:</p>
<ul>
<li>Bin 1 – Unsorted bin</li>
<li>Bin 2 to Bin 63 – Small bin</li>
<li>Bin 64 to Bin 126 – Large bin</li>
</ul>
<p><span style="text-decoration:underline;"><em>Fast Bin</em></span>: Chunks of&nbsp;size <a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L1249" target="_blank">16</a> to <a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L1600" target="_blank">80</a> bytes is called a fast chunk. Bins holding fast chunks are called fast bins. Among all the bins, fast bins are faster in memory allocation and deallocation.</p>
<ul>
<li>Number of bins – <a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L1680" target="_blank">10</a>
<ul>
<li>Each fast bin contains a single linked list (a.k.a binlist) of free chunks. Single linked list is used since in fast bins chunks are not removed from the middle of the list. Both addition and deletion happens at the front end of the list – LIFO.</li>
</ul>
</li>
<li>Chunk size – <a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L1595" target="_blank">8 bytes apart</a>
<ul>
<li>Fast bins contain a binlist of chunks whose sizes are 8 bytes apart. ie) First fast bin (index 0) contains binlist of chunks of size 16 bytes, second fast bin (index 1) contains binlist of chunks of size &nbsp;24 bytes and so on…</li>
<li>Chunks inside a particular fast&nbsp;bin are of same sizes.</li>
</ul>
</li>
<li>During <a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L1778" target="_blank">malloc initialization</a>,&nbsp;maximum fast bin size is <a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L1795" target="_blank">set</a> to <a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L794" target="_blank">64</a> (!80) bytes. Hence by default chunks of size 16 to 64 is categorized as fast chunks.</li>
<li>No Coalescing – Two chunks which are free can be adjacent to each other, it doesnt get combined into single free chunk. No coalescing could result in external fragmentation but it speeds up free!!</li>
<li>malloc(fast chunk) –
<ul>
<li>Initially&nbsp;<a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L1765" target="_blank">fast bin max size</a> and <a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L1680" target="_blank">fast bin indices</a> would be empty and hence eventhough user requested a fast chunk, instead of <a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L3330" target="_blank">fast bin code</a>, <a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L3367" target="_blank">small bin code</a> tries to service it.</li>
<li>Later when its not empty, fast bin index is <a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L3332" target="_blank">calculated</a> to retrieve&nbsp;its corresponding binlist.</li>
<li>First chunk&nbsp;from the above retrieved binlist is <a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L3341" target="_blank">removed</a> and <a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L3355" target="_blank">returned</a> to the user.</li>
</ul>
</li>
<li>free(fast chunk) –
<ul>
<li>Fast bin index is <a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L3887" target="_blank">calculated</a>&nbsp;to retrieve its corresponding binlist.</li>
<li>This free chunk gets <a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L3908" target="_blank">added at the front position</a> of the above retrieved binlist.</li>
</ul>
</li>
</ul>
<p><img class=" aligncenter" src="./Understanding glibc malloc – sploitF-U-N_files/sRV48m6inD0d7vdT83qziBw.png" alt="" width="960" height="720"></p>
<p><span style="text-decoration:underline;"><em>Unsorted Bin</em></span>: When small or large chunk gets freed instead of adding them in to their respective bins, its gets <a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L3988" target="_blank">added</a> into unsorted bin. This approach gives ‘glibc malloc’ a second chance to <a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L3432" target="_blank">reuse</a> the recently freed chunks. Hence memory allocation and deallocation speeds up a bit (because of unsorted bin) since time taken to look for appropriate bin is eliminated.</p>
<ul>
<li>Number of bins – 1
<ul>
<li>Unsorted bin contains a circular double linked list (a.k.a binlist) of free chunks.</li>
</ul>
</li>
<li>Chunk size – There is no size restriction, chunks of <em>any</em> size belongs to this bin.</li>
</ul>
<p><img class="alignnone" src="./Understanding glibc malloc – sploitF-U-N_files/sOKHm_YojzekopUlsZWBPEw.png" alt="" width="1216" height="865"></p>
<p><span style="text-decoration:underline;"><em>Small Bin</em></span>:&nbsp;Chunks of&nbsp;size <a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L1470" target="_blank">less than&nbsp;512</a> bytes is called as small chunk. Bins holding small chunks are called small&nbsp;bins. Small bins are faster than large bins (but slower than fast bins) in memory allocation and deallocation.</p>
<ul>
<li>Number of bins – 62
<ul>
<li>Each small&nbsp;bin contains a circular double&nbsp;linked list (a.k.a binlist) of free chunks. Double&nbsp;linked list is used since in small&nbsp;bins chunks are unlinked&nbsp;from the middle of the list. Here addition happens at the front end and deletion happens at the rear end of the list – FIFO.</li>
</ul>
</li>
<li>Chunk Size – <a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L1473" target="_blank">8 bytes apart</a>
<ul>
<li>Small&nbsp;bin contains a binlist of chunks whose sizes are 8 bytes apart. ie) First Small&nbsp;bin (Bin 2) contains binlist of chunks of size 16 bytes, second small bin (Bin 3) contains binlist of chunks of size 24 bytes and so on…</li>
<li>Chunks inside a small bin are of same sizes and hence it doesnt need to be sorted.</li>
</ul>
</li>
<li>Coalescing – Two chunks which are free cant be adjacent to each other, it gets <a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L3964" target="_blank">combined</a> into single free chunk. Coalescing eliminates external fragmentation but it slows up free!!</li>
<li>malloc(small chunk) –
<ul>
<li>Initially all small&nbsp;bins would be NULL&nbsp;and hence eventhough user requested a small&nbsp;chunk, instead of&nbsp;<a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L3367" target="_blank">small bin code</a>,&nbsp;<a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L3432" target="_blank">unsorted&nbsp;bin code</a> tries to service it.</li>
<li>Also during the first call to malloc, small bin and large bin datastructures (<a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L1689" target="_blank">bins</a>) found in malloc_state is initialized ie) <a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L3372" target="_blank">bins would point to itself </a>signifying they are empty.</li>
<li>Later when small bin is non empty, last chunk&nbsp;from its corresponding binlist is <a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L3372" target="_blank">removed</a> and <a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L3393" target="_blank">returned</a> to the user.</li>
</ul>
</li>
<li>free(small chunk) –
<ul>
<li>While freeing this chunk, check if its <a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L3964" target="_blank">previous</a> or <a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L3976" target="_blank">next</a> chunk is free, if so coalesce ie) unlink those chunks from their respective linked lists&nbsp;and then add the new consolidated chunk into the <a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L3995" target="_blank">beginning of unsorted bin’s </a>linked list.</li>
</ul>
</li>
</ul>
<p><span style="text-decoration:underline;"><em>Large Bin</em></span>:&nbsp;Chunks of&nbsp;size greater than equal to 512 is called a large chunk. Bins holding large&nbsp;chunks are called large&nbsp;bins. Large&nbsp;bins are slower than small bins in memory allocation and deallocation.</p>
<ul>
<li>Number of bins – 63
<ul>
<li>Each large&nbsp;bin contains a circular double&nbsp;linked list (a.k.a binlist) of free chunks.&nbsp;Double&nbsp;linked list is used since in large&nbsp;bins chunks are added and removed&nbsp;at any position (front or middle or rear).</li>
<li>Out of these 63 bins:
<ul>
<li>32 bins contain binlist of chunks of size which are <a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L1478" target="_blank">64 bytes apart</a>.&nbsp;ie) First large bin (Bin 65)&nbsp;contains binlist of chunks of size 512 bytes to 568 bytes, second large bin (Bin 66) contains binlist of chunks of size 576 bytes to 632 bytes and so on…</li>
<li>16 bins contain binlist of chunks of size which are <a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L1479" target="_blank">512 bytes apart</a>.</li>
<li>8 bins contain binlist of chunks of size which are <a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L1480" target="_blank">4096 bytes apart</a>.</li>
<li>4 bins contain binlist of chunks of size which are <a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L1481" target="_blank">32768 bytes apart</a>.</li>
<li>2 bins contain binlist of chunks of size which are <a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L1482" target="_blank">262144&nbsp;bytes apart</a>.</li>
<li>1 bin contains a chunk of <a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L1483" target="_blank">remaining</a> size.</li>
</ul>
</li>
<li>Unlike small bin, chunks inside a large bin are NOT of same size. Hence they are stored in decreasing order. Largest chunk is stored&nbsp;in the front end while the smallest chunk is stored in the rear end of its binlist.</li>
</ul>
</li>
<li>Coalescing – Two chunks which are free cant be adjacent to each other, it gets <a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L3964" target="_blank">combined</a> into single free chunk.</li>
<li>malloc(large chunk) –
<ul>
<li><a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L3571" target="_blank">Initially</a> all large&nbsp;bins would be NULL&nbsp;and hence eventhough user requested a large&nbsp;chunk, instead of <a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L3566" target="_blank">large&nbsp;bin code</a>,&nbsp;<a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L3639" target="_blank">next largest bin code</a> tries to service it.</li>
<li>Also during the first call to malloc, small bin and large bin datastructures (bins) found in malloc_state is <a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L3411" target="_blank">initialized</a> ie) bins would point to itself signifying they are empty.</li>
<li>Later when large&nbsp;bin is non empty, if the <a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L3571" target="_blank">largest chunk size (in its binlist) is greater than user requested size</a>, binlist is <a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L3575" target="_blank">walked from rear end to front end</a>, to find a suitable chunk whose size is near/equal to user requested size. Once found, that chunk is <a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L3584" target="_blank">split</a> into two chunks
<ul>
<li>User chunk (of user requested size) – returned to user.</li>
<li>Remainder chunk (of remaining size) – added to unsorted bin.</li>
</ul>
</li>
<li>If <a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L3571" target="_blank">largest chunk size (in its binlist) is lesser&nbsp;than user requested size</a>, try to service user request by using the next largest (non empty) bin. Next largest bin code <a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L3648" target="_blank">scans</a> the binmaps to find the next largest bin which is non empty, if any such bin <a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L3682" target="_blank">found</a>, a suitable chunk from that binlist is retrieved, <a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L3687" target="_blank">split</a> and returned to the user. If not found, try serving user request using <a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L3653" target="_blank">top chunk</a>.</li>
</ul>
</li>
<li>free(large chunk) – Its procedure is similar to free(small chunk).</li>
</ul>
<p><span style="text-decoration:underline;"><em>Top Chunk</em></span>: Chunk which is at the top border of an arena is called <a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L1683" target="_blank">top chunk</a>. It&nbsp;doesnt belong to any bin. Top chunk is used to service user request when there is <a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L3739" target="_blank">NO free blocks</a>, in any of the bins. If <a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L3760" target="_blank">top chunk size is greater than user requested size</a>&nbsp;top chunk is split into two:</p>
<ul>
<li>User chunk (of user requested size)</li>
<li>Remainder chunk (of remaining size)</li>
</ul>
<p>The <a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L3762" target="_blank">remainder chunk becomes the new top</a>. If top chunk size is lesser than user requested size, top chunk is <a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L3790" target="_blank">extended</a> using <a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L2458" target="_blank">sbrk</a> (main arena) or <a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L2390" target="_blank">mmap</a> (thread arena) syscall.</p>
<p><span style="text-decoration:underline;"><em>Last Remainder Chunk</em></span>: Remainder from the most recent split of a small request. Last remainder chunk helps to improve locality of reference ie) consecutive malloc request of small chunks might end up being allocated close to each other.</p>
<p>But out of the many chunks available in an arena, which chunk qualifies to be&nbsp;last remainder chunk?</p>
<p>When a user request of small chunk, cannot be served by a small bin and unsorted bin, binmaps are scanned to find next largest (non empty) bin. As said earlier, on finding the next largest (non empty) bin, its split into two, user chunk gets returned to the user and remainder chunk gets added to the unsorted bin. In addition to it, <a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L3721" target="_blank">it becomes the new last remainder chunk</a>.</p>
<p>How locality of reference is achieved?</p>
<p>Now when <a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L3449" target="_blank">user subsequently request’s a small chunk and if the last remainder chunk is the only chunk in unsorted bin</a>, last remainder chunk is <a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L3455" target="_blank">split</a> into two, user&nbsp;chunk gets returned to the user and remainder chunk gets added to the unsorted bin.&nbsp;In addition to it, <a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/malloc.c#L3458" target="_blank">it becomes the new last remainder chunk</a>. Thus subsequent memory allocations end up being next to each other.</p>
<div id="atatags-370373-5b0b65a38d850">
        <script type="text/javascript">
            __ATA.cmd.push(function() {
                __ATA.initVideoSlot('atatags-370373-5b0b65a38d850', {
                    sectionId: '370373',
                    format: 'inread'
                });
            });
        </script>
    </div>		<div class="wpcnt">
			<div class="wpa wpmrec">
				<span class="wpa-about">Advertisements</span>
				<div class="u">		<div style="padding-bottom:15px;width:300px;height:250px;float:left;margin-right:5px;margin-top:0px">
		<div id="atatags-26942-5b0b65a38d87f" style="overflow: hidden; position: relative; width: auto; height: auto;"><div style="width: 300px; height: 250px;"><iframe frameborder="0" scrolling="no" width="300" height="250" style="border:none;overflow:hidden;width:300px;height:250px;" src="./Understanding glibc malloc – sploitF-U-N_files/saved_resource.html"></iframe></div><div id="atatags-26942-5b0b65a38d87f__controls" style="width:300px;height:10px;text-align:right;line-height:6px;"><span id="atatags-26942-5b0b65a38d87f__complain-btn" style="font-size: 10px; color: rgb(109, 171, 210); text-decoration: underline; cursor: pointer; display: inline;">Report this ad</span></div></div></div>		<div style="padding-bottom:15px;width:300px;height:250px;float:left;margin-top:0px">
		<div id="atatags-114160-5b0b65a38d881" style="overflow: hidden; position: relative; width: auto; height: auto;"><div style="width: 300px; height: 250px;"><iframe frameborder="0" scrolling="no" width="300" height="250" style="border:none;overflow:hidden;width:300px;height:250px;" src="./Understanding glibc malloc – sploitF-U-N_files/saved_resource(13).html"></iframe></div><div id="atatags-114160-5b0b65a38d881__controls" style="width:300px;height:10px;text-align:right;line-height:6px;"><span id="atatags-114160-5b0b65a38d881__complain-btn" style="font-size: 10px; color: rgb(109, 171, 210); text-decoration: underline; cursor: pointer; display: inline;">Report this ad</span></div></div></div></div>
				
			</div>
		</div><div id="jp-post-flair" class="sharedaddy sd-like-enabled sd-sharing-enabled"><div class="sharedaddy sd-sharing-enabled"><div class="robots-nocontent sd-block sd-social sd-social-icon-text sd-sharing"><h3 class="sd-title">Share this:</h3><div class="sd-content"><ul><li class="share-twitter"><a rel="nofollow" data-shared="sharing-twitter-3" class="share-twitter sd-button share-icon" href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?share=twitter&amp;nb=1" target="_blank" title="Click to share on Twitter"><span>Twitter</span></a></li><li class="share-facebook"><a rel="nofollow" data-shared="sharing-facebook-3" class="share-facebook sd-button share-icon" href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?share=facebook&amp;nb=1" target="_blank" title="Click to share on Facebook"><span>Facebook</span></a></li><li class="share-google-plus-1"><a rel="nofollow" data-shared="sharing-google-3" class="share-google-plus-1 sd-button share-icon" href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?share=google-plus-1&amp;nb=1" target="_blank" title="Click to share on Google+"><span>Google</span></a></li><li class="share-end"></li></ul></div></div></div><div class="sharedaddy sd-block sd-like jetpack-likes-widget-wrapper jetpack-likes-widget-loaded" id="like-post-wrapper-84729955-3-5b0b65a392fbe" data-src="//widgets.wp.com/likes/index.html?ver=20180319#blog_id=84729955&amp;post_id=3&amp;origin=sploitfun.wordpress.com&amp;obj_id=84729955-3-5b0b65a392fbe" data-name="like-post-frame-84729955-3-5b0b65a392fbe"><h3 class="sd-title">Like this:</h3><div class="likes-widget-placeholder post-likes-widget-placeholder" style="height: 55px; display: none;"><span class="button"><span>Like</span></span> <span class="loading">Loading...</span></div><iframe class="post-likes-widget jetpack-likes-widget" name="like-post-frame-84729955-3-5b0b65a392fbe" height="55px" width="100%" frameborder="0" src="./Understanding glibc malloc – sploitF-U-N_files/index.html"></iframe><span class="sd-text-color"></span><a class="sd-link-color"></a></div>
<div id="jp-relatedposts" class="jp-relatedposts" style="display: block;">
	<h3 class="jp-relatedposts-headline"><em>Related</em></h3>
<div class="jp-relatedposts-items jp-relatedposts-items-minimal"><p class="jp-relatedposts-post jp-relatedposts-post0" data-post-id="172" data-post-format="false"><span class="jp-relatedposts-post-title"><a class="jp-relatedposts-post-a" href="https://sploitfun.wordpress.com/2015/02/26/heap-overflow-using-unlink/" title="Heap overflow using unlink

Prerequisite: Understanding glibc malloc In this post lets learn how heap overflow can be successfully exploited using unlink technique. But before looking into unlink, first lets look into a vulnerable program: /* Heap overflow vulnerable program. */ #include &lt;stdlib.h&gt; #include &lt;string.h&gt; int main( int argc, char * argv[] ) {…" rel="nofollow" data-origin="3" data-position="0">Heap overflow using unlink</a></span><span class="jp-relatedposts-post-context">In "glibc"</span></p><p class="jp-relatedposts-post jp-relatedposts-post1" data-post-id="186" data-post-format="false"><span class="jp-relatedposts-post-title"><a class="jp-relatedposts-post-a" href="https://sploitfun.wordpress.com/2015/03/04/heap-overflow-using-malloc-maleficarum/" title="Heap overflow using Malloc Maleficarum

Prerequisite: Understanding glibc malloc During late 2004, &#39;glibc malloc&#39; got hardened. After which techniques such as unlink got obsolete, leaving the attackers clueless. But only for some time since in late 2005, &#39;Phantasmal Phatasmagoria&#39; came with below series of techniques to successfully exploit heap overflow. House of Prime House of…" rel="nofollow" data-origin="3" data-position="1">Heap overflow using Malloc Maleficarum</a></span><span class="jp-relatedposts-post-context">In "glibc"</span></p><p class="jp-relatedposts-post jp-relatedposts-post2" data-post-id="446" data-post-format="false"><span class="jp-relatedposts-post-title"><a class="jp-relatedposts-post-a" href="https://sploitfun.wordpress.com/2015/06/26/linux-x86-exploit-development-tutorial-series/" title="Linux (x86) Exploit Development Series

First of all I would like to thank phrack articles, its author and other security researchers for teaching me about different exploit techniques, without whom none of the posts would have been possible!! I firmly believe that always original reference articles are the best place to learn stuffs. But at times we may…" rel="nofollow" data-origin="3" data-position="2">Linux (x86) Exploit Development Series</a></span><span class="jp-relatedposts-post-context">With 19 comments</span></p></div></div></div>			</div><!-- .entry-content -->

	<footer class="entry-meta">
		
			<span class="tags-links">Tagged <a href="https://sploitfun.wordpress.com/tag/glibc/" rel="tag">glibc</a>, <a href="https://sploitfun.wordpress.com/tag/heap/" rel="tag">heap</a>, <a href="https://sploitfun.wordpress.com/tag/malloc/" rel="tag">malloc</a>, <a href="https://sploitfun.wordpress.com/tag/ptmalloc/" rel="tag">ptmalloc</a></span>
			</footer><!-- .entry-meta -->
</article><!-- #post-## -->

				<nav role="navigation" id="nav-below" class="post-navigation">
		<h1 class="screen-reader-text">Post navigation</h1>

	
				<div class="nav-next"><a href="https://sploitfun.wordpress.com/2015/02/11/syscalls-used-by-malloc/" rel="next">Syscalls used by&nbsp;malloc. <span class="meta-nav">→</span></a></div>
	
	</nav><!-- #nav-below -->
	
			
<div id="comments" class="comments-area">

	
			<h2 class="comments-title">
			45 thoughts on “<span>Understanding glibc malloc</span>”		</h2>

		
		<ol class="comment-list">
					<li id="comment-4" class="pingback even thread-even depth-1 highlander-comment">
			<article id="div-comment-4" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
												<b class="fn"><a href="https://sploitfun.wordpress.com/2015/02/26/heap-overflow-using-unlink/" rel="external nofollow" class="url">Heap overflow using unlink | sploitF-U-N</a></b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/#comment-4">
							<time datetime="2015-02-26T14:19:11+00:00">
								February 26, 2015 at 2:19 pm							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>[…] Understanding glibc malloc […]</p>
<p id="comment-like-4" data-liked="comment-not-liked" class="comment-likes comment-not-liked"><a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?like_comment=4&amp;_wpnonce=918fcc79b6" class="comment-like-link needs-login" rel="nofollow" data-blog="84729955"><span>Like</span></a><span id="comment-like-count-4" class="comment-like-feedback">Like</span></p>
				</div><!-- .comment-content -->

				<div class="reply"><a rel="nofollow" class="comment-reply-link" href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?replytocom=4#respond" onclick="return addComment.moveForm( &quot;div-comment-4&quot;, &quot;4&quot;, &quot;respond&quot;, &quot;3&quot; )" aria-label="Reply to Heap overflow using unlink | sploitF-U-N">Reply</a></div>			</article><!-- .comment-body -->
</li><!-- #comment-## -->
		<li id="comment-5" class="pingback odd alt thread-odd thread-alt depth-1 highlander-comment">
			<article id="div-comment-5" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
												<b class="fn"><a href="https://sploitfun.wordpress.com/2015/03/04/heap-overflow-using-malloc-maleficarum/" rel="external nofollow" class="url">Heap overflow using Malloc Maleficarum | sploitF-U-N</a></b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/#comment-5">
							<time datetime="2015-03-04T11:06:02+00:00">
								March 4, 2015 at 11:06 am							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>[…] Understanding glibc malloc […]</p>
<p id="comment-like-5" data-liked="comment-not-liked" class="comment-likes comment-not-liked"><a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?like_comment=5&amp;_wpnonce=1da1830855" class="comment-like-link needs-login" rel="nofollow" data-blog="84729955"><span>Like</span></a><span id="comment-like-count-5" class="comment-like-feedback">Like</span></p>
				</div><!-- .comment-content -->

				<div class="reply"><a rel="nofollow" class="comment-reply-link" href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?replytocom=5#respond" onclick="return addComment.moveForm( &quot;div-comment-5&quot;, &quot;5&quot;, &quot;respond&quot;, &quot;3&quot; )" aria-label="Reply to Heap overflow using Malloc Maleficarum | sploitF-U-N">Reply</a></div>			</article><!-- .comment-body -->
</li><!-- #comment-## -->
		<li id="comment-13" class="comment byuser comment-author-reiniurban even thread-even depth-1 parent highlander-comment">
			<article id="div-comment-13" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt="" src="./Understanding glibc malloc – sploitF-U-N_files/5c2888084ed6ac4c1c6e71cbd6bd23a4.jpeg" class="avatar avatar-50 grav-hashed grav-hijack" height="50" width="50" id="grav-5c2888084ed6ac4c1c6e71cbd6bd23a4-0">						<b class="fn"><a href="http://rurban.xarch.at/" rel="external nofollow" class="url">rurban</a></b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/#comment-13">
							<time datetime="2015-04-06T13:52:15+00:00">
								April 6, 2015 at 1:52 pm							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>You forgot to mention the improved version, called ptmalloc3.</p>
<p id="comment-like-13" data-liked="comment-not-liked" class="comment-likes comment-not-liked"><a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?like_comment=13&amp;_wpnonce=1a2d72cf65" class="comment-like-link needs-login" rel="nofollow" data-blog="84729955"><span>Like</span></a><span id="comment-like-count-13" class="comment-like-feedback">Liked by <a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/#" class="view-likers" data-like-count="1">1 person</a></span></p>
				</div><!-- .comment-content -->

				<div class="reply"><a rel="nofollow" class="comment-reply-link" href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?replytocom=13#respond" onclick="return addComment.moveForm( &quot;div-comment-13&quot;, &quot;13&quot;, &quot;respond&quot;, &quot;3&quot; )" aria-label="Reply to rurban">Reply</a></div>			</article><!-- .comment-body -->
<ul class="children">
		<li id="comment-14" class="comment byuser comment-author-sploitfun bypostauthor odd alt depth-2 parent highlander-comment">
			<article id="div-comment-14" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt="" src="./Understanding glibc malloc – sploitF-U-N_files/7faebbbda48a4e89777919430e5b9766.jpeg" class="avatar avatar-50 grav-hashed grav-hijack" height="50" width="50" id="grav-7faebbbda48a4e89777919430e5b9766-0">						<b class="fn"><a href="https://sploitfun.wordpress.com/" rel="external nofollow" class="url">sploitfun</a></b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/#comment-14">
							<time datetime="2015-04-06T14:41:19+00:00">
								April 6, 2015 at 2:41 pm							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>Yup im yet to look into ptmalloc3, so just avoided it here. Thanks for reading my post!!</p>
<p id="comment-like-14" data-liked="comment-not-liked" class="comment-likes comment-not-liked"><a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?like_comment=14&amp;_wpnonce=54f561f46c" class="comment-like-link needs-login" rel="nofollow" data-blog="84729955"><span>Like</span></a><span id="comment-like-count-14" class="comment-like-feedback">Like</span></p>
				</div><!-- .comment-content -->

				<div class="reply"><a rel="nofollow" class="comment-reply-link" href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?replytocom=14#respond" onclick="return addComment.moveForm( &quot;div-comment-14&quot;, &quot;14&quot;, &quot;respond&quot;, &quot;3&quot; )" aria-label="Reply to sploitfun">Reply</a></div>			</article><!-- .comment-body -->
<ul class="children">
		<li id="comment-537" class="comment even depth-3 highlander-comment">
			<article id="div-comment-537" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt="" src="./Understanding glibc malloc – sploitF-U-N_files/f4b4036422c8f698d2a477c874fb9c6f.jpeg" class="avatar avatar-50 grav-hashed grav-hijack" height="50" width="50" id="grav-f4b4036422c8f698d2a477c874fb9c6f-0">						<b class="fn">Avinash Hanwate</b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/#comment-537">
							<time datetime="2017-02-06T04:23:34+00:00">
								February 6, 2017 at 4:23 am							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>can you provide a block diagram of ptmalloc version 3 with data structures used in it?</p>
<p id="comment-like-537" data-liked="comment-not-liked" class="comment-likes comment-not-liked"><a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?like_comment=537&amp;_wpnonce=74dd9969a7" class="comment-like-link needs-login" rel="nofollow" data-blog="84729955"><span>Like</span></a><span id="comment-like-count-537" class="comment-like-feedback">Like</span></p>
				</div><!-- .comment-content -->

							</article><!-- .comment-body -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
		<li id="comment-15" class="comment odd alt thread-odd thread-alt depth-1 parent highlander-comment">
			<article id="div-comment-15" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt="" src="./Understanding glibc malloc – sploitF-U-N_files/879ea09b37cde0743badd59f81fa918f" class="avatar avatar-50 grav-hashed grav-hijack" height="50" width="50" id="grav-879ea09b37cde0743badd59f81fa918f-0">						<b class="fn">chris</b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/#comment-15">
							<time datetime="2015-04-06T20:08:51+00:00">
								April 6, 2015 at 8:08 pm							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>Great artical</p>
<p id="comment-like-15" data-liked="comment-not-liked" class="comment-likes comment-not-liked"><a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?like_comment=15&amp;_wpnonce=4ab0efcf9d" class="comment-like-link needs-login" rel="nofollow" data-blog="84729955"><span>Like</span></a><span id="comment-like-count-15" class="comment-like-feedback">Like</span></p>
				</div><!-- .comment-content -->

				<div class="reply"><a rel="nofollow" class="comment-reply-link" href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?replytocom=15#respond" onclick="return addComment.moveForm( &quot;div-comment-15&quot;, &quot;15&quot;, &quot;respond&quot;, &quot;3&quot; )" aria-label="Reply to chris">Reply</a></div>			</article><!-- .comment-body -->
<ul class="children">
		<li id="comment-21" class="comment byuser comment-author-sploitfun bypostauthor even depth-2 highlander-comment">
			<article id="div-comment-21" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt="" src="./Understanding glibc malloc – sploitF-U-N_files/7faebbbda48a4e89777919430e5b9766.jpeg" class="avatar avatar-50 grav-hashed grav-hijack" height="50" width="50" id="grav-7faebbbda48a4e89777919430e5b9766-1">						<b class="fn"><a href="https://sploitfun.wordpress.com/" rel="external nofollow" class="url">sploitfun</a></b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/#comment-21">
							<time datetime="2015-04-07T11:21:16+00:00">
								April 7, 2015 at 11:21 am							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>Thanks Chris!!</p>
<p id="comment-like-21" data-liked="comment-not-liked" class="comment-likes comment-not-liked"><a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?like_comment=21&amp;_wpnonce=b9a1c0de36" class="comment-like-link needs-login" rel="nofollow" data-blog="84729955"><span>Like</span></a><span id="comment-like-count-21" class="comment-like-feedback">Like</span></p>
				</div><!-- .comment-content -->

				<div class="reply"><a rel="nofollow" class="comment-reply-link" href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?replytocom=21#respond" onclick="return addComment.moveForm( &quot;div-comment-21&quot;, &quot;21&quot;, &quot;respond&quot;, &quot;3&quot; )" aria-label="Reply to sploitfun">Reply</a></div>			</article><!-- .comment-body -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
		<li id="comment-17" class="comment odd alt thread-even depth-1 parent highlander-comment">
			<article id="div-comment-17" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt="" src="./Understanding glibc malloc – sploitF-U-N_files/7ee111df8bebd34d31c4f096458de1c1" class="avatar avatar-50 grav-hashed grav-hijack" height="50" width="50" id="grav-7ee111df8bebd34d31c4f096458de1c1-0">						<b class="fn">ibivmfmvihit</b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/#comment-17">
							<time datetime="2015-04-06T23:39:53+00:00">
								April 6, 2015 at 11:39 pm							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>Hrm. Unless something has changed you’re wrong in a few places. You call a section of memory allocated with a mmap call a per thread arena, which is not correct. From memory once you exceed a certain size you always get mmap, which you correctly note, however no additional Metadata is stored for that allocation and when it is freed it just gets passed to munmap.</p>
<p>Unless something had changed you don’t automatically get a new heap per thread. </p>
<p>Eyeroll. Baltimore.</p>
<p id="comment-like-17" data-liked="comment-not-liked" class="comment-likes comment-not-liked"><a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?like_comment=17&amp;_wpnonce=3d41840c97" class="comment-like-link needs-login" rel="nofollow" data-blog="84729955"><span>Like</span></a><span id="comment-like-count-17" class="comment-like-feedback">Like</span></p>
				</div><!-- .comment-content -->

				<div class="reply"><a rel="nofollow" class="comment-reply-link" href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?replytocom=17#respond" onclick="return addComment.moveForm( &quot;div-comment-17&quot;, &quot;17&quot;, &quot;respond&quot;, &quot;3&quot; )" aria-label="Reply to ibivmfmvihit">Reply</a></div>			</article><!-- .comment-body -->
<ul class="children">
		<li id="comment-24" class="comment byuser comment-author-sploitfun bypostauthor even depth-2 highlander-comment">
			<article id="div-comment-24" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt="" src="./Understanding glibc malloc – sploitF-U-N_files/7faebbbda48a4e89777919430e5b9766.jpeg" class="avatar avatar-50 grav-hashed grav-hijack" height="50" width="50" id="grav-7faebbbda48a4e89777919430e5b9766-2">						<b class="fn"><a href="https://sploitfun.wordpress.com/" rel="external nofollow" class="url">sploitfun</a></b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/#comment-24">
							<time datetime="2015-04-07T11:51:26+00:00">
								April 7, 2015 at 11:51 am							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>Hmm I don’t think so per thread arenas do use mmap!! AFAIK mmap is used in below two places</p>
<p>1. When non main thread call malloc, <a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/arena.c#L535" target="_blank" rel="nofollow">mmap</a> is used and this mapped region contains <a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/arena.c#L736" target="_blank" rel="nofollow">metadata</a> like heap_info and mstate. This space doesn’t get released to OS immediately when user does free since even though the space is obtained using mmap syscall, munmap isn’t invoked since IS_MMAPPED bit is not set.<br>
2. When user requested size is greater than threshold size, mmap is used and this mmapped region doesn’t contain any metadata (as you rightly pointed out). This space is released to OS immediately when user does free i.e.) munmap gets invoked since IS_MMAPED bit is set.</p>
<p>I’m no expert in glibc malloc, this is my first attempt reading its source code, so I might be wrong at times, but in this context it looks I’m correct!! If not do comment back, I am happy to rectify it!!</p>
<p id="comment-like-24" data-liked="comment-not-liked" class="comment-likes comment-not-liked"><a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?like_comment=24&amp;_wpnonce=fe5ef74a15" class="comment-like-link needs-login" rel="nofollow" data-blog="84729955"><span>Like</span></a><span id="comment-like-count-24" class="comment-like-feedback">Like</span></p>
				</div><!-- .comment-content -->

				<div class="reply"><a rel="nofollow" class="comment-reply-link" href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?replytocom=24#respond" onclick="return addComment.moveForm( &quot;div-comment-24&quot;, &quot;24&quot;, &quot;respond&quot;, &quot;3&quot; )" aria-label="Reply to sploitfun">Reply</a></div>			</article><!-- .comment-body -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
		<li id="comment-19" class="comment odd alt thread-odd thread-alt depth-1 parent highlander-comment">
			<article id="div-comment-19" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt="" src="./Understanding glibc malloc – sploitF-U-N_files/6e8881245aec6dc302b647bda91a45da" class="avatar avatar-50 grav-hashed grav-hijack" height="50" width="50" id="grav-6e8881245aec6dc302b647bda91a45da-0">						<b class="fn">S. Rahul</b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/#comment-19">
							<time datetime="2015-04-07T02:47:11+00:00">
								April 7, 2015 at 2:47 am							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>A very well written article. Helps a lot in understanding and visualizing how things work.<br>
I went through glibc malloc code lots of times while working on some issues at my work place but your explanation made me understand certain things in a much better way. Thanks a lot.</p>
<p id="comment-like-19" data-liked="comment-not-liked" class="comment-likes comment-not-liked"><a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?like_comment=19&amp;_wpnonce=32470ef6a9" class="comment-like-link needs-login" rel="nofollow" data-blog="84729955"><span>Like</span></a><span id="comment-like-count-19" class="comment-like-feedback">Liked by <a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/#" class="view-likers" data-like-count="1">1 person</a></span></p>
				</div><!-- .comment-content -->

				<div class="reply"><a rel="nofollow" class="comment-reply-link" href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?replytocom=19#respond" onclick="return addComment.moveForm( &quot;div-comment-19&quot;, &quot;19&quot;, &quot;respond&quot;, &quot;3&quot; )" aria-label="Reply to S. Rahul">Reply</a></div>			</article><!-- .comment-body -->
<ul class="children">
		<li id="comment-23" class="comment byuser comment-author-sploitfun bypostauthor even depth-2 highlander-comment">
			<article id="div-comment-23" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt="" src="./Understanding glibc malloc – sploitF-U-N_files/7faebbbda48a4e89777919430e5b9766.jpeg" class="avatar avatar-50 grav-hashed grav-hijack" height="50" width="50" id="grav-7faebbbda48a4e89777919430e5b9766-3">						<b class="fn"><a href="https://sploitfun.wordpress.com/" rel="external nofollow" class="url">sploitfun</a></b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/#comment-23">
							<time datetime="2015-04-07T11:44:37+00:00">
								April 7, 2015 at 11:44 am							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>Thanks a lot Rahul!! I envy you for looking into glibc malloc code as part of your work, I never got such an opp <img draggable="false" class="emoji" alt="😛" src="./Understanding glibc malloc – sploitF-U-N_files/1f61b.svg"> </p>
<p>I’m a fan of <a href="http://duartes.org/gustavo/blog/" target="_blank" rel="nofollow">Gustavo Duarte’s</a> blog posts, so just mimicked his style <img draggable="false" class="emoji" alt="🙂" src="./Understanding glibc malloc – sploitF-U-N_files/1f642.svg"></p>
<p id="comment-like-23" data-liked="comment-not-liked" class="comment-likes comment-not-liked"><a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?like_comment=23&amp;_wpnonce=74614ebe32" class="comment-like-link needs-login" rel="nofollow" data-blog="84729955"><span>Like</span></a><span id="comment-like-count-23" class="comment-like-feedback">Like</span></p>
				</div><!-- .comment-content -->

				<div class="reply"><a rel="nofollow" class="comment-reply-link" href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?replytocom=23#respond" onclick="return addComment.moveForm( &quot;div-comment-23&quot;, &quot;23&quot;, &quot;respond&quot;, &quot;3&quot; )" aria-label="Reply to sploitfun">Reply</a></div>			</article><!-- .comment-body -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
		<li id="comment-25" class="comment odd alt thread-even depth-1 parent highlander-comment">
			<article id="div-comment-25" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt="" src="./Understanding glibc malloc – sploitF-U-N_files/43fbdb7a0dfc74fb17ed1dc08883f6ee" class="avatar avatar-50 grav-hashed grav-hijack" height="50" width="50" id="grav-43fbdb7a0dfc74fb17ed1dc08883f6ee-0">						<b class="fn">Guy Fawkes</b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/#comment-25">
							<time datetime="2015-04-07T11:57:46+00:00">
								April 7, 2015 at 11:57 am							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>When talking about the case where there are more threads (4 – main + 3 threads) than 2 * cores (2), I’m not sure I understood your explanation. Why are there 3 arenas (Main Arena, Arena 1, Arena 2) when we only have 1 core?<br>
I think it should go like this:<br>
– main thread uses main arena<br>
– thread 1 uses arena 1<br>
– thread 2 cannot create a new arena and so loops over existing arenas and tries to lock an arena; let’s say he locks main arena; now main thread and thread 2 share main arena<br>
– thread 3 cannot create a new arena and so loops over existing arenas and tries to lock an arena; let’s say he locks arena 1; now thread  1 and thread 3 share main arena<br>
Am I right?</p>
<p>Also, when talking about large bins, you say there are 2 bins with chunk sizes 256KB apart and one bin with a chunk of the remaining size. How is the size of this largest chunk determined? Initially I thought it was the top chunk, but then I read that the top chunk isn’t part of any bin. So what’s the deal with this chunk in the largest bin?</p>
<p>Anyway, great article. Thanks for writing it.</p>
<p id="comment-like-25" data-liked="comment-not-liked" class="comment-likes comment-not-liked"><a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?like_comment=25&amp;_wpnonce=14d52231bd" class="comment-like-link needs-login" rel="nofollow" data-blog="84729955"><span>Like</span></a><span id="comment-like-count-25" class="comment-like-feedback">Liked by <a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/#" class="view-likers" data-like-count="1">1 person</a></span></p>
				</div><!-- .comment-content -->

				<div class="reply"><a rel="nofollow" class="comment-reply-link" href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?replytocom=25#respond" onclick="return addComment.moveForm( &quot;div-comment-25&quot;, &quot;25&quot;, &quot;respond&quot;, &quot;3&quot; )" aria-label="Reply to Guy Fawkes">Reply</a></div>			</article><!-- .comment-body -->
<ul class="children">
		<li id="comment-26" class="comment byuser comment-author-sploitfun bypostauthor even depth-2 highlander-comment">
			<article id="div-comment-26" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt="" src="./Understanding glibc malloc – sploitF-U-N_files/7faebbbda48a4e89777919430e5b9766.jpeg" class="avatar avatar-50 grav-hashed grav-hijack" height="50" width="50" id="grav-7faebbbda48a4e89777919430e5b9766-4">						<b class="fn"><a href="https://sploitfun.wordpress.com/" rel="external nofollow" class="url">sploitfun</a></b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/#comment-26">
							<time datetime="2015-04-08T15:03:35+00:00">
								April 8, 2015 at 3:03 pm							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>1. Initially while skimming the source code, I was also under the impression that for 32 bit systems, no of arenas = 2 * no of cores but looking closer I found that no of arenas = 2* no of cores <strong>+ 1</strong>. One extra arena gets added because of <a href="https://github.com/sploitfun/lsploits/blob/master/glibc/malloc/arena.c#L845" target="_blank" rel="nofollow">this condition</a> in arena_get2. Frankly I also dont know the reason behind that one extra arena <img draggable="false" class="emoji" alt="🙂" src="./Understanding glibc malloc – sploitF-U-N_files/1f642.svg"></p>
<p>2. These bins are bit tricky, so to avoid confusions I haven’t talked about bin_at and binmaps in the blog post. But to just answer your question, each bin has its own capacity. For instance bin 124 contains chunks of size ranging from 163840 to 262136, while bin 125 contains chunks of size ranging from 262144 to 524280. The last bin 126 contains chunks of size &gt;= 524288. </p>
<p>For example when we have a chunk of size 162KB it gets stored in bin 124, while chunk of size 260KB gets stored in bin 125. And when we have a chunk of size 515KB it cant be found in bin 2 to 125 since this size exceeds every bin’s capacity. Thus such chunks gets stored in the last bin – Bin 126!!</p>
<p>Incase if you are not very clear about “how chunks of size &gt;= 128KB can get into large bins when they can only be mmapped and NOT brk’d!! See <a href="https://github.com/sploitfun/lsploits/blob/master/hof/ptmalloc.ppt/comments/cons.c" target="_blank" rel="nofollow">this</a> example. </p>
<p>Thanks for reading it <img draggable="false" class="emoji" alt="🙂" src="./Understanding glibc malloc – sploitF-U-N_files/1f642.svg"></p>
<p id="comment-like-26" data-liked="comment-not-liked" class="comment-likes comment-not-liked"><a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?like_comment=26&amp;_wpnonce=0a71b205d5" class="comment-like-link needs-login" rel="nofollow" data-blog="84729955"><span>Like</span></a><span id="comment-like-count-26" class="comment-like-feedback">Liked by <a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/#" class="view-likers" data-like-count="1">1 person</a></span></p>
				</div><!-- .comment-content -->

				<div class="reply"><a rel="nofollow" class="comment-reply-link" href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?replytocom=26#respond" onclick="return addComment.moveForm( &quot;div-comment-26&quot;, &quot;26&quot;, &quot;respond&quot;, &quot;3&quot; )" aria-label="Reply to sploitfun">Reply</a></div>			</article><!-- .comment-body -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
		<li id="comment-28" class="comment odd alt thread-odd thread-alt depth-1 parent highlander-comment">
			<article id="div-comment-28" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt="" src="./Understanding glibc malloc – sploitF-U-N_files/d390f3408cbd5735f88ef0c4f7e1dab8" class="avatar avatar-50 grav-hashed grav-hijack" height="50" width="50" id="grav-d390f3408cbd5735f88ef0c4f7e1dab8-0">						<b class="fn">Anon</b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/#comment-28">
							<time datetime="2015-04-09T20:45:24+00:00">
								April 9, 2015 at 8:45 pm							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>Hi, great article this is my fourth reading (since m a slow learner and the last part about the different bins is pretty hardcore at least to me =/), its pretty great the only thing that bothers me is the style of the explanations since you first like to explain and make references to future part (like the output analysis) and i got pretty lost on the first try, since i was always thinking “wtf, is this guy talking about… oooh its explaining whats below :facepalm:”.</p>
<p>Kindest Regards</p>
<p id="comment-like-28" data-liked="comment-not-liked" class="comment-likes comment-not-liked"><a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?like_comment=28&amp;_wpnonce=e2e3457c6a" class="comment-like-link needs-login" rel="nofollow" data-blog="84729955"><span>Like</span></a><span id="comment-like-count-28" class="comment-like-feedback">Liked by <a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/#" class="view-likers" data-like-count="1">1 person</a></span></p>
				</div><!-- .comment-content -->

				<div class="reply"><a rel="nofollow" class="comment-reply-link" href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?replytocom=28#respond" onclick="return addComment.moveForm( &quot;div-comment-28&quot;, &quot;28&quot;, &quot;respond&quot;, &quot;3&quot; )" aria-label="Reply to Anon">Reply</a></div>			</article><!-- .comment-body -->
<ul class="children">
		<li id="comment-29" class="comment byuser comment-author-sploitfun bypostauthor even depth-2 highlander-comment">
			<article id="div-comment-29" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt="" src="./Understanding glibc malloc – sploitF-U-N_files/7faebbbda48a4e89777919430e5b9766.jpeg" class="avatar avatar-50 grav-hashed grav-hijack" height="50" width="50" id="grav-7faebbbda48a4e89777919430e5b9766-5">						<b class="fn"><a href="https://sploitfun.wordpress.com/" rel="external nofollow" class="url">sploitfun</a></b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/#comment-29">
							<time datetime="2015-04-10T08:08:24+00:00">
								April 10, 2015 at 8:08 am							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>Yes there is a lot, I need to improve upon in blogging. Its my early days, so do bear with me <img draggable="false" class="emoji" alt="🙂" src="./Understanding glibc malloc – sploitF-U-N_files/1f642.svg"> In future posts I will try to make a definite structure!! Thanks for reading!!</p>
<p id="comment-like-29" data-liked="comment-not-liked" class="comment-likes comment-not-liked"><a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?like_comment=29&amp;_wpnonce=c44cdc4508" class="comment-like-link needs-login" rel="nofollow" data-blog="84729955"><span>Like</span></a><span id="comment-like-count-29" class="comment-like-feedback">Like</span></p>
				</div><!-- .comment-content -->

				<div class="reply"><a rel="nofollow" class="comment-reply-link" href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?replytocom=29#respond" onclick="return addComment.moveForm( &quot;div-comment-29&quot;, &quot;29&quot;, &quot;respond&quot;, &quot;3&quot; )" aria-label="Reply to sploitfun">Reply</a></div>			</article><!-- .comment-body -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
		<li id="comment-80" class="pingback odd alt thread-even depth-1 highlander-comment">
			<article id="div-comment-80" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
												<b class="fn"><a href="http://www.blogosfera.co.uk/in-c-can-new-in-one-thread-allocate-the-memory-deleted-by-other-thread/" rel="external nofollow" class="url">In C++, can new in one thread allocate the memory deleted by other thread? - BlogoSfera</a></b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/#comment-80">
							<time datetime="2015-07-04T23:44:00+00:00">
								July 4, 2015 at 11:44 pm							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>[…] In glibc, malloc is implemented with arenas. So, for example, it is possible that the memory first allocated by malloc and later freed in thread A can not be used by another call of malloc in thread B, since thread A and B may be in different arenas, and different arenas maintain different heaps and free lists of memory. […]</p>
<p id="comment-like-80" data-liked="comment-not-liked" class="comment-likes comment-not-liked"><a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?like_comment=80&amp;_wpnonce=291f786d11" class="comment-like-link needs-login" rel="nofollow" data-blog="84729955"><span>Like</span></a><span id="comment-like-count-80" class="comment-like-feedback">Like</span></p>
				</div><!-- .comment-content -->

				<div class="reply"><a rel="nofollow" class="comment-reply-link" href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?replytocom=80#respond" onclick="return addComment.moveForm( &quot;div-comment-80&quot;, &quot;80&quot;, &quot;respond&quot;, &quot;3&quot; )" aria-label="Reply to In C++, can new in one thread allocate the memory deleted by other thread? - BlogoSfera">Reply</a></div>			</article><!-- .comment-body -->
</li><!-- #comment-## -->
		<li id="comment-167" class="comment even thread-odd thread-alt depth-1 highlander-comment">
			<article id="div-comment-167" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt="" src="./Understanding glibc malloc – sploitF-U-N_files/437927767c6e4e01cb6f4f5b027ddd9f" class="avatar avatar-50 grav-hashed grav-hijack" height="50" width="50" id="grav-437927767c6e4e01cb6f4f5b027ddd9f-0">						<b class="fn">someone</b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/#comment-167">
							<time datetime="2015-09-26T02:01:51+00:00">
								September 26, 2015 at 2:01 am							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>Thanks for this great article!</p>
<p id="comment-like-167" data-liked="comment-not-liked" class="comment-likes comment-not-liked"><a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?like_comment=167&amp;_wpnonce=4ab60e3b50" class="comment-like-link needs-login" rel="nofollow" data-blog="84729955"><span>Like</span></a><span id="comment-like-count-167" class="comment-like-feedback">Like</span></p>
				</div><!-- .comment-content -->

				<div class="reply"><a rel="nofollow" class="comment-reply-link" href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?replytocom=167#respond" onclick="return addComment.moveForm( &quot;div-comment-167&quot;, &quot;167&quot;, &quot;respond&quot;, &quot;3&quot; )" aria-label="Reply to someone">Reply</a></div>			</article><!-- .comment-body -->
</li><!-- #comment-## -->
		<li id="comment-179" class="comment byuser comment-author-sylvestee odd alt thread-even depth-1 highlander-comment">
			<article id="div-comment-179" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt="" src="./Understanding glibc malloc – sploitF-U-N_files/ab0f4abc324a9bf4ab632c4273a1bc59.jpeg" class="avatar avatar-50 grav-hashed grav-hijack" height="50" width="50" id="grav-ab0f4abc324a9bf4ab632c4273a1bc59-0">						<b class="fn"><a href="http://sylvestee.wordpress.com/" rel="external nofollow" class="url">ryzn</a></b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/#comment-179">
							<time datetime="2015-10-11T13:19:42+00:00">
								October 11, 2015 at 1:19 pm							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>Great article, help me for understanding glibc malloc very well. Thanks a lot.</p>
<p id="comment-like-179" data-liked="comment-not-liked" class="comment-likes comment-not-liked"><a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?like_comment=179&amp;_wpnonce=582c6f3f3b" class="comment-like-link needs-login" rel="nofollow" data-blog="84729955"><span>Like</span></a><span id="comment-like-count-179" class="comment-like-feedback">Like</span></p>
				</div><!-- .comment-content -->

				<div class="reply"><a rel="nofollow" class="comment-reply-link" href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?replytocom=179#respond" onclick="return addComment.moveForm( &quot;div-comment-179&quot;, &quot;179&quot;, &quot;respond&quot;, &quot;3&quot; )" aria-label="Reply to ryzn">Reply</a></div>			</article><!-- .comment-body -->
</li><!-- #comment-## -->
		<li id="comment-197" class="comment even thread-odd thread-alt depth-1 highlander-comment">
			<article id="div-comment-197" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt="" src="./Understanding glibc malloc – sploitF-U-N_files/d72d43904f6fa91394298ada10f77115" class="avatar avatar-50 grav-hashed grav-hijack" height="50" width="50" id="grav-d72d43904f6fa91394298ada10f77115-0">						<b class="fn">muhe</b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/#comment-197">
							<time datetime="2015-11-19T14:50:56+00:00">
								November 19, 2015 at 2:50 pm							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>Wonderful! That’s help me understand glibc well~  Thx!</p>
<p id="comment-like-197" data-liked="comment-not-liked" class="comment-likes comment-not-liked"><a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?like_comment=197&amp;_wpnonce=22e149ba5d" class="comment-like-link needs-login" rel="nofollow" data-blog="84729955"><span>Like</span></a><span id="comment-like-count-197" class="comment-like-feedback">Like</span></p>
				</div><!-- .comment-content -->

				<div class="reply"><a rel="nofollow" class="comment-reply-link" href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?replytocom=197#respond" onclick="return addComment.moveForm( &quot;div-comment-197&quot;, &quot;197&quot;, &quot;respond&quot;, &quot;3&quot; )" aria-label="Reply to muhe">Reply</a></div>			</article><!-- .comment-body -->
</li><!-- #comment-## -->
		<li id="comment-246" class="comment odd alt thread-even depth-1 parent highlander-comment">
			<article id="div-comment-246" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt="" src="./Understanding glibc malloc – sploitF-U-N_files/3200856455b08e044975e0c8755fd354" class="avatar avatar-50 grav-hashed grav-hijack" height="50" width="50" id="grav-3200856455b08e044975e0c8755fd354-0">						<b class="fn"><a href="http://blog.naver.com/mathboy7" rel="external nofollow" class="url">mathboy7</a></b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/#comment-246">
							<time datetime="2016-01-29T04:33:27+00:00">
								January 29, 2016 at 4:33 am							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>Hello! Thanks for great article… it helps my study so much.. thank you! <img draggable="false" class="emoji" alt="🙂" src="./Understanding glibc malloc – sploitF-U-N_files/1f642.svg"><br>
I’m a student in Korea. There is no documents about explaining glibc heap structure… so I wanna translate this article into Korean and upload in my blog.<br>
may I translate this article…? (P.S I’m sorry about my English is not good…:( )</p>
<p id="comment-like-246" data-liked="comment-not-liked" class="comment-likes comment-not-liked"><a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?like_comment=246&amp;_wpnonce=9775b327b1" class="comment-like-link needs-login" rel="nofollow" data-blog="84729955"><span>Like</span></a><span id="comment-like-count-246" class="comment-like-feedback">Like</span></p>
				</div><!-- .comment-content -->

				<div class="reply"><a rel="nofollow" class="comment-reply-link" href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?replytocom=246#respond" onclick="return addComment.moveForm( &quot;div-comment-246&quot;, &quot;246&quot;, &quot;respond&quot;, &quot;3&quot; )" aria-label="Reply to mathboy7">Reply</a></div>			</article><!-- .comment-body -->
<ul class="children">
		<li id="comment-248" class="comment byuser comment-author-sploitfun bypostauthor even depth-2 parent highlander-comment">
			<article id="div-comment-248" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt="" src="./Understanding glibc malloc – sploitF-U-N_files/7faebbbda48a4e89777919430e5b9766.jpeg" class="avatar avatar-50 grav-hashed grav-hijack" height="50" width="50" id="grav-7faebbbda48a4e89777919430e5b9766-6">						<b class="fn"><a href="https://sploitfun.wordpress.com/" rel="external nofollow" class="url">sploitfun</a></b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/#comment-248">
							<time datetime="2016-02-01T03:46:34+00:00">
								February 1, 2016 at 3:46 am							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>Sure go ahead!! Thanks for reading!!!</p>
<p id="comment-like-248" data-liked="comment-not-liked" class="comment-likes comment-not-liked"><a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?like_comment=248&amp;_wpnonce=877a618c5b" class="comment-like-link needs-login" rel="nofollow" data-blog="84729955"><span>Like</span></a><span id="comment-like-count-248" class="comment-like-feedback">Like</span></p>
				</div><!-- .comment-content -->

				<div class="reply"><a rel="nofollow" class="comment-reply-link" href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?replytocom=248#respond" onclick="return addComment.moveForm( &quot;div-comment-248&quot;, &quot;248&quot;, &quot;respond&quot;, &quot;3&quot; )" aria-label="Reply to sploitfun">Reply</a></div>			</article><!-- .comment-body -->
<ul class="children">
		<li id="comment-400" class="comment odd alt depth-3 highlander-comment">
			<article id="div-comment-400" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt="" src="./Understanding glibc malloc – sploitF-U-N_files/a0675c9b3361594028575d0135d534c3" class="avatar avatar-50 grav-hashed grav-hijack" height="50" width="50" id="grav-a0675c9b3361594028575d0135d534c3-0">						<b class="fn">Phenix</b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/#comment-400">
							<time datetime="2016-08-09T04:05:09+00:00">
								August 9, 2016 at 4:05 am							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>It is really a good article. I also want to translate this article into Chinese.</p>
<p id="comment-like-400" data-liked="comment-not-liked" class="comment-likes comment-not-liked"><a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?like_comment=400&amp;_wpnonce=4e64b6afdc" class="comment-like-link needs-login" rel="nofollow" data-blog="84729955"><span>Like</span></a><span id="comment-like-count-400" class="comment-like-feedback">Like</span></p>
				</div><!-- .comment-content -->

							</article><!-- .comment-body -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
		<li id="comment-283" class="comment even thread-odd thread-alt depth-1 parent highlander-comment">
			<article id="div-comment-283" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt="" src="./Understanding glibc malloc – sploitF-U-N_files/8d430d83cda7fbdbee1f862388c561ac" class="avatar avatar-50 grav-hashed grav-hijack" height="50" width="50" id="grav-8d430d83cda7fbdbee1f862388c561ac-0">						<b class="fn"><a href="https://www.facebook.com/app_scoped_user_id/1691175071099502/" rel="external nofollow" class="url">wanchouchou</a></b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/#comment-283">
							<time datetime="2016-03-18T17:30:55+00:00">
								March 18, 2016 at 5:30 pm							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>Great article! Thank you for share!!!</p>
<p id="comment-like-283" data-liked="comment-not-liked" class="comment-likes comment-not-liked"><a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?like_comment=283&amp;_wpnonce=40fdbf30ab" class="comment-like-link needs-login" rel="nofollow" data-blog="84729955"><span>Like</span></a><span id="comment-like-count-283" class="comment-like-feedback">Liked by <a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/#" class="view-likers" data-like-count="1">1 person</a></span></p>
				</div><!-- .comment-content -->

				<div class="reply"><a rel="nofollow" class="comment-reply-link" href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?replytocom=283#respond" onclick="return addComment.moveForm( &quot;div-comment-283&quot;, &quot;283&quot;, &quot;respond&quot;, &quot;3&quot; )" aria-label="Reply to wanchouchou">Reply</a></div>			</article><!-- .comment-body -->
<ul class="children">
		<li id="comment-286" class="comment byuser comment-author-wanchouchou odd alt depth-2 highlander-comment">
			<article id="div-comment-286" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt="" src="./Understanding glibc malloc – sploitF-U-N_files/8d430d83cda7fbdbee1f862388c561ac" class="avatar avatar-50 grav-hashed grav-hijack" height="50" width="50" id="grav-8d430d83cda7fbdbee1f862388c561ac-1">						<b class="fn"><a href="https://www.facebook.com/app_scoped_user_id/1691175071099502/" rel="external nofollow" class="url">wanchouchou</a></b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/#comment-286">
							<time datetime="2016-03-23T08:13:21+00:00">
								March 23, 2016 at 8:13 am							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>Great article! I hava learned lots of knowledge about glibc malloc by this article, thank you!<br>
And I’m a student too, from China, I also want to translate this article into Chinese and display in my blog . May I translate it D:)?</p>
<p>In addition, I have a question about the range of chunk size of each large bin. In your description, you said that “First large bin (Bin 65) contains binlist of chunks of size 512 bytes to 568 bytes”. I know why it is start from 512 bytes, by can’t  understand why it is end up to 568 bytes instead of 575? I  find the ‘glibc malloc’ how to calculate a large bin’s index by requested size,  from the source code in malloc.c line 1477, it use this code:<br>
   #define largebin_index_32(sz)                                                \<br>
  (((((unsigned long) (sz)) &gt;&gt; 6) &gt; 6) <img width="16" height="16" class="wp-smiley emoji" draggable="false" alt=":\" src="./Understanding glibc malloc – sploitF-U-N_files/uneasy.svg" style="height: 1em; max-height: 1em;"><br>
   ((((unsigned long) (sz)) &gt;&gt; 9) &gt; 9) <img width="16" height="16" class="wp-smiley emoji" draggable="false" alt=":\" src="./Understanding glibc malloc – sploitF-U-N_files/uneasy.svg" style="height: 1em; max-height: 1em;"><br>
   ((((unsigned long) (sz)) &gt;&gt; 12) &gt; 12) <img width="16" height="16" class="wp-smiley emoji" draggable="false" alt=":\" src="./Understanding glibc malloc – sploitF-U-N_files/uneasy.svg" style="height: 1em; max-height: 1em;"><br>
   ((((unsigned long) (sz)) &gt;&gt; 15) &gt; 15) <img width="16" height="16" class="wp-smiley emoji" draggable="false" alt=":\" src="./Understanding glibc malloc – sploitF-U-N_files/uneasy.svg" style="height: 1em; max-height: 1em;"><br>
   ((((unsigned long) (sz)) &gt;&gt; 18) &gt; 18) <img width="16" height="16" class="wp-smiley emoji" draggable="false" alt=":\" src="./Understanding glibc malloc – sploitF-U-N_files/uneasy.svg" style="height: 1em; max-height: 1em;"><br>
   126)</p>
<p>It means that if the size is between 512 and 575, the index of large bin was 64,  and if the size is between 576 and 639, the index was 65, and so on.. So why the end up size of each large bin, in your description,  is  8 bytes less than what I calculated? Is there something else I have not noticed? Thank you.</p>
<p id="comment-like-286" data-liked="comment-not-liked" class="comment-likes comment-not-liked"><a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?like_comment=286&amp;_wpnonce=1e14aec763" class="comment-like-link needs-login" rel="nofollow" data-blog="84729955"><span>Like</span></a><span id="comment-like-count-286" class="comment-like-feedback">Like</span></p>
				</div><!-- .comment-content -->

				<div class="reply"><a rel="nofollow" class="comment-reply-link" href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?replytocom=286#respond" onclick="return addComment.moveForm( &quot;div-comment-286&quot;, &quot;286&quot;, &quot;respond&quot;, &quot;3&quot; )" aria-label="Reply to wanchouchou">Reply</a></div>			</article><!-- .comment-body -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
		<li id="comment-296" class="pingback even thread-even depth-1 highlander-comment">
			<article id="div-comment-296" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
												<b class="fn"><a href="https://babyphd.net/2016/04/unlink-technique/" rel="external nofollow" class="url">Unlink technique | BabyPhD CTF Team</a></b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/#comment-296">
							<time datetime="2016-04-08T12:43:39+00:00">
								April 8, 2016 at 12:43 pm							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>[…] REFERENCES:&nbsp; <a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/" rel="nofollow">https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/</a> […]</p>
<p id="comment-like-296" data-liked="comment-not-liked" class="comment-likes comment-not-liked"><a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?like_comment=296&amp;_wpnonce=145096a24d" class="comment-like-link needs-login" rel="nofollow" data-blog="84729955"><span>Like</span></a><span id="comment-like-count-296" class="comment-like-feedback">Like</span></p>
				</div><!-- .comment-content -->

				<div class="reply"><a rel="nofollow" class="comment-reply-link" href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?replytocom=296#respond" onclick="return addComment.moveForm( &quot;div-comment-296&quot;, &quot;296&quot;, &quot;respond&quot;, &quot;3&quot; )" aria-label="Reply to Unlink technique | BabyPhD CTF Team">Reply</a></div>			</article><!-- .comment-body -->
</li><!-- #comment-## -->
		<li id="comment-329" class="pingback odd alt thread-odd thread-alt depth-1 highlander-comment">
			<article id="div-comment-329" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
												<b class="fn"><a href="http://extranet.securemymind.com/2016051314612.html" rel="external nofollow" class="url">Linux堆内存管理深入分析（上） | 信息安全海外资讯</a></b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/#comment-329">
							<time datetime="2016-05-13T00:10:29+00:00">
								May 13, 2016 at 12:10 am							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>[…] 前段时间偶然学习了这篇文章：Understanding glibc malloc […]</p>
<p id="comment-like-329" data-liked="comment-not-liked" class="comment-likes comment-not-liked"><a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?like_comment=329&amp;_wpnonce=146580be50" class="comment-like-link needs-login" rel="nofollow" data-blog="84729955"><span>Like</span></a><span id="comment-like-count-329" class="comment-like-feedback">Like</span></p>
				</div><!-- .comment-content -->

				<div class="reply"><a rel="nofollow" class="comment-reply-link" href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?replytocom=329#respond" onclick="return addComment.moveForm( &quot;div-comment-329&quot;, &quot;329&quot;, &quot;respond&quot;, &quot;3&quot; )" aria-label="Reply to Linux堆内存管理深入分析（上） | 信息安全海外资讯">Reply</a></div>			</article><!-- .comment-body -->
</li><!-- #comment-## -->
		<li id="comment-349" class="comment even thread-even depth-1 highlander-comment">
			<article id="div-comment-349" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt="" src="./Understanding glibc malloc – sploitF-U-N_files/ad16ad8ec932281b1427583640932579" class="avatar avatar-50 grav-hashed grav-hijack" height="50" width="50" id="grav-ad16ad8ec932281b1427583640932579-0">						<b class="fn">tkay</b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/#comment-349">
							<time datetime="2016-05-26T07:36:42+00:00">
								May 26, 2016 at 7:36 am							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>It is one of the best article about glibc malloc I’ve ever read so far!<br>
Many thanks for the great article!</p>
<p id="comment-like-349" data-liked="comment-not-liked" class="comment-likes comment-not-liked"><a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?like_comment=349&amp;_wpnonce=4e9ae7f93d" class="comment-like-link needs-login" rel="nofollow" data-blog="84729955"><span>Like</span></a><span id="comment-like-count-349" class="comment-like-feedback">Like</span></p>
				</div><!-- .comment-content -->

				<div class="reply"><a rel="nofollow" class="comment-reply-link" href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?replytocom=349#respond" onclick="return addComment.moveForm( &quot;div-comment-349&quot;, &quot;349&quot;, &quot;respond&quot;, &quot;3&quot; )" aria-label="Reply to tkay">Reply</a></div>			</article><!-- .comment-body -->
</li><!-- #comment-## -->
		<li id="comment-378" class="comment odd alt thread-odd thread-alt depth-1 highlander-comment">
			<article id="div-comment-378" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt="" src="./Understanding glibc malloc – sploitF-U-N_files/280f113b2365bcddf0db7148532e2834" class="avatar avatar-50 grav-hashed grav-hijack" height="50" width="50" id="grav-280f113b2365bcddf0db7148532e2834-0">						<b class="fn">SigmaPhi</b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/#comment-378">
							<time datetime="2016-06-27T13:13:23+00:00">
								June 27, 2016 at 1:13 pm							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>Nowadays,I read glibc malloc about version 2.17,but  I dont know when the main arena to be  initialized. Before  the user first call malloc, what happened? Can you help me,please?</p>
<p id="comment-like-378" data-liked="comment-not-liked" class="comment-likes comment-not-liked"><a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?like_comment=378&amp;_wpnonce=41c145ff38" class="comment-like-link needs-login" rel="nofollow" data-blog="84729955"><span>Like</span></a><span id="comment-like-count-378" class="comment-like-feedback">Like</span></p>
				</div><!-- .comment-content -->

				<div class="reply"><a rel="nofollow" class="comment-reply-link" href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?replytocom=378#respond" onclick="return addComment.moveForm( &quot;div-comment-378&quot;, &quot;378&quot;, &quot;respond&quot;, &quot;3&quot; )" aria-label="Reply to SigmaPhi">Reply</a></div>			</article><!-- .comment-body -->
</li><!-- #comment-## -->
		<li id="comment-381" class="comment even thread-even depth-1 parent highlander-comment">
			<article id="div-comment-381" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt="" src="./Understanding glibc malloc – sploitF-U-N_files/picture" class="avatar avatar-50" height="50" width="50">						<b class="fn"><a href="https://www.facebook.com/app_scoped_user_id/1019268671526596/" rel="external nofollow" class="url">조힘찬빛</a></b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/#comment-381">
							<time datetime="2016-07-03T06:57:03+00:00">
								July 3, 2016 at 6:57 am							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>Hi.<br>
Can I ( translate (Article *it, language Korean) &amp;&amp; post (Article *it, Article *on_my_blog) ) it ?</p>
<p id="comment-like-381" data-liked="comment-not-liked" class="comment-likes comment-not-liked"><a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?like_comment=381&amp;_wpnonce=c9c0616a9d" class="comment-like-link needs-login" rel="nofollow" data-blog="84729955"><span>Like</span></a><span id="comment-like-count-381" class="comment-like-feedback">Like</span></p>
				</div><!-- .comment-content -->

				<div class="reply"><a rel="nofollow" class="comment-reply-link" href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?replytocom=381#respond" onclick="return addComment.moveForm( &quot;div-comment-381&quot;, &quot;381&quot;, &quot;respond&quot;, &quot;3&quot; )" aria-label="Reply to 조힘찬빛">Reply</a></div>			</article><!-- .comment-body -->
<ul class="children">
		<li id="comment-382" class="comment byuser comment-author-sploitfun bypostauthor odd alt depth-2 highlander-comment">
			<article id="div-comment-382" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt="" src="./Understanding glibc malloc – sploitF-U-N_files/7faebbbda48a4e89777919430e5b9766.jpeg" class="avatar avatar-50 grav-hashed grav-hijack" height="50" width="50" id="grav-7faebbbda48a4e89777919430e5b9766-7">						<b class="fn"><a href="https://sploitfun.wordpress.com/" rel="external nofollow" class="url">sploitfun</a></b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/#comment-382">
							<time datetime="2016-07-04T03:13:05+00:00">
								July 4, 2016 at 3:13 am							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>Sure.. All yours!!</p>
<p id="comment-like-382" data-liked="comment-not-liked" class="comment-likes comment-not-liked"><a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?like_comment=382&amp;_wpnonce=23c787552c" class="comment-like-link needs-login" rel="nofollow" data-blog="84729955"><span>Like</span></a><span id="comment-like-count-382" class="comment-like-feedback">Like</span></p>
				</div><!-- .comment-content -->

				<div class="reply"><a rel="nofollow" class="comment-reply-link" href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?replytocom=382#respond" onclick="return addComment.moveForm( &quot;div-comment-382&quot;, &quot;382&quot;, &quot;respond&quot;, &quot;3&quot; )" aria-label="Reply to sploitfun">Reply</a></div>			</article><!-- .comment-body -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
		<li id="comment-398" class="pingback even thread-odd thread-alt depth-1 highlander-comment">
			<article id="div-comment-398" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
												<b class="fn"><a href="http://thisissecurity.net/2016/07/27/the-macabre-danse-of-memory-chunks/" rel="external nofollow" class="url">The macabre danse of memory chunks | This is Security :: by Stormshield</a></b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/#comment-398">
							<time datetime="2016-07-27T13:51:41+00:00">
								July 27, 2016 at 1:51 pm							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>[…] further, we strongly encourage the reader to go through glibc malloc internals. The post made by sploitfun is probably the best documentation on glibc allocator (ptmalloc2). Here we just the recap, the […]</p>
<p id="comment-like-398" data-liked="comment-not-liked" class="comment-likes comment-not-liked"><a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?like_comment=398&amp;_wpnonce=1dea6c5531" class="comment-like-link needs-login" rel="nofollow" data-blog="84729955"><span>Like</span></a><span id="comment-like-count-398" class="comment-like-feedback">Like</span></p>
				</div><!-- .comment-content -->

				<div class="reply"><a rel="nofollow" class="comment-reply-link" href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?replytocom=398#respond" onclick="return addComment.moveForm( &quot;div-comment-398&quot;, &quot;398&quot;, &quot;respond&quot;, &quot;3&quot; )" aria-label="Reply to The macabre danse of memory chunks | This is Security :: by Stormshield">Reply</a></div>			</article><!-- .comment-body -->
</li><!-- #comment-## -->
		<li id="comment-411" class="pingback odd alt thread-even depth-1 highlander-comment">
			<article id="div-comment-411" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
												<b class="fn"><a href="http://thisissecurity.net/2016/07/27/the-macabre-dance-of-memory-chunks/" rel="external nofollow" class="url">The macabre dance of memory chunks | This is Security :: by Stormshield</a></b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/#comment-411">
							<time datetime="2016-09-16T13:01:00+00:00">
								September 16, 2016 at 1:01 pm							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>[…] further, we strongly encourage the reader to go through glibc malloc internals. The post made by sploitfun is probably the best documentation on glibc allocator (ptmalloc2). Here we just recap the structure […]</p>
<p id="comment-like-411" data-liked="comment-not-liked" class="comment-likes comment-not-liked"><a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?like_comment=411&amp;_wpnonce=0bbce7c66c" class="comment-like-link needs-login" rel="nofollow" data-blog="84729955"><span>Like</span></a><span id="comment-like-count-411" class="comment-like-feedback">Like</span></p>
				</div><!-- .comment-content -->

				<div class="reply"><a rel="nofollow" class="comment-reply-link" href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?replytocom=411#respond" onclick="return addComment.moveForm( &quot;div-comment-411&quot;, &quot;411&quot;, &quot;respond&quot;, &quot;3&quot; )" aria-label="Reply to The macabre dance of memory chunks | This is Security :: by Stormshield">Reply</a></div>			</article><!-- .comment-body -->
</li><!-- #comment-## -->
		<li id="comment-417" class="pingback even thread-odd thread-alt depth-1 highlander-comment">
			<article id="div-comment-417" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt="" src="./Understanding glibc malloc – sploitF-U-N_files/d335ddaa17ee875d59ab674a82385ada.png" class="avatar avatar-50" height="50" width="50">						<b class="fn"><a href="https://hardcoretechieblog.wordpress.com/2016/09/24/realtime-memory-allocation%e7%a0%94%e7%a9%b6/" rel="external nofollow" class="url">Realtime Memory Allocation研究 | Rebuild Yourself</a></b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/#comment-417">
							<time datetime="2016-09-24T12:00:44+00:00">
								September 24, 2016 at 12:00 pm							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>[…]  jemalloc (2006) A Scalable Concurrent malloc(3) Implementation for FreeBSD   ptmalloc (2006) Understanding glibc malloc  Hoard (2000) Hoard: A Scalable Memory Allocator for Multithreaded Applications   […]</p>
<p id="comment-like-417" data-liked="comment-not-liked" class="comment-likes comment-not-liked"><a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?like_comment=417&amp;_wpnonce=5ae866cfa2" class="comment-like-link needs-login" rel="nofollow" data-blog="84729955"><span>Like</span></a><span id="comment-like-count-417" class="comment-like-feedback">Like</span></p>
				</div><!-- .comment-content -->

				<div class="reply"><a rel="nofollow" class="comment-reply-link" href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?replytocom=417#respond" onclick="return addComment.moveForm( &quot;div-comment-417&quot;, &quot;417&quot;, &quot;respond&quot;, &quot;3&quot; )" aria-label="Reply to Realtime Memory Allocation研究 | Rebuild Yourself">Reply</a></div>			</article><!-- .comment-body -->
</li><!-- #comment-## -->
		<li id="comment-419" class="comment odd alt thread-even depth-1 highlander-comment">
			<article id="div-comment-419" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt="" src="./Understanding glibc malloc – sploitF-U-N_files/4b496f565c099c1cfc173e7772402f7f" class="avatar avatar-50 grav-hashed grav-hijack" height="50" width="50" id="grav-4b496f565c099c1cfc173e7772402f7f-0">						<b class="fn">laogong</b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/#comment-419">
							<time datetime="2016-09-26T05:32:07+00:00">
								September 26, 2016 at 5:32 am							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>“When thread 1 and thread 2 calls malloc for the first time, a new arena is created for them and its used without any contention. Until this point threads and arena have one-to-one mapping.”<br>
thread 1 and thread 2 will not create two thread arena??</p>
<p id="comment-like-419" data-liked="comment-not-liked" class="comment-likes comment-not-liked"><a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?like_comment=419&amp;_wpnonce=44c4c7daac" class="comment-like-link needs-login" rel="nofollow" data-blog="84729955"><span>Like</span></a><span id="comment-like-count-419" class="comment-like-feedback">Like</span></p>
				</div><!-- .comment-content -->

				<div class="reply"><a rel="nofollow" class="comment-reply-link" href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?replytocom=419#respond" onclick="return addComment.moveForm( &quot;div-comment-419&quot;, &quot;419&quot;, &quot;respond&quot;, &quot;3&quot; )" aria-label="Reply to laogong">Reply</a></div>			</article><!-- .comment-body -->
</li><!-- #comment-## -->
		<li id="comment-453" class="comment byuser comment-author-savanpatel3 even thread-odd thread-alt depth-1 highlander-comment">
			<article id="div-comment-453" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt="" src="./Understanding glibc malloc – sploitF-U-N_files/c1a18ca2d27010a9d9bd3f7330924a3e.png" class="avatar avatar-50 grav-hashed grav-hijack" height="50" width="50" id="grav-c1a18ca2d27010a9d9bd3f7330924a3e-0">						<b class="fn"><a href="http://savanpatel.in/" rel="external nofollow" class="url">Savan Patel</a></b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/#comment-453">
							<time datetime="2016-11-02T03:41:18+00:00">
								November 2, 2016 at 3:41 am							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>Thanks for wonderful explanation. It helped me to optimize my own implementation<br>
One question I have is,<br>
Why is it 2* number of cores and 8 * number of cores.</p>
<p>What is the reasoning behind choosing 2 and 8 as factor for 32 and 64 bit architecture respectively.</p>
<p>it would be good of you could throw some light over it.</p>
<p id="comment-like-453" data-liked="comment-not-liked" class="comment-likes comment-not-liked"><a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?like_comment=453&amp;_wpnonce=ddc4cfc7c7" class="comment-like-link needs-login" rel="nofollow" data-blog="84729955"><span>Like</span></a><span id="comment-like-count-453" class="comment-like-feedback">Like</span></p>
				</div><!-- .comment-content -->

				<div class="reply"><a rel="nofollow" class="comment-reply-link" href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?replytocom=453#respond" onclick="return addComment.moveForm( &quot;div-comment-453&quot;, &quot;453&quot;, &quot;respond&quot;, &quot;3&quot; )" aria-label="Reply to Savan Patel">Reply</a></div>			</article><!-- .comment-body -->
</li><!-- #comment-## -->
		<li id="comment-461" class="comment odd alt thread-even depth-1 highlander-comment">
			<article id="div-comment-461" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt="" src="./Understanding glibc malloc – sploitF-U-N_files/3c3cafb6a0e0c8f4ab1c28fa30291a81" class="avatar avatar-50 grav-hashed grav-hijack" height="50" width="50" id="grav-3c3cafb6a0e0c8f4ab1c28fa30291a81-0">						<b class="fn">skysider</b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/#comment-461">
							<time datetime="2016-11-15T01:18:40+00:00">
								November 15, 2016 at 1:18 am							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>freed small chunk will be always added to unsorted bin? so when a freed chunk will be added to small bin list?</p>
<p id="comment-like-461" data-liked="comment-not-liked" class="comment-likes comment-not-liked"><a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?like_comment=461&amp;_wpnonce=75efcd0add" class="comment-like-link needs-login" rel="nofollow" data-blog="84729955"><span>Like</span></a><span id="comment-like-count-461" class="comment-like-feedback">Like</span></p>
				</div><!-- .comment-content -->

				<div class="reply"><a rel="nofollow" class="comment-reply-link" href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?replytocom=461#respond" onclick="return addComment.moveForm( &quot;div-comment-461&quot;, &quot;461&quot;, &quot;respond&quot;, &quot;3&quot; )" aria-label="Reply to skysider">Reply</a></div>			</article><!-- .comment-body -->
</li><!-- #comment-## -->
		<li id="comment-464" class="comment even thread-odd thread-alt depth-1 parent highlander-comment">
			<article id="div-comment-464" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt="" src="./Understanding glibc malloc – sploitF-U-N_files/0ba7b91182db068a3c110f7becddaf14" class="avatar avatar-50 grav-hashed grav-hijack" height="50" width="50" id="grav-0ba7b91182db068a3c110f7becddaf14-0">						<b class="fn">Kush</b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/#comment-464">
							<time datetime="2016-11-28T18:53:20+00:00">
								November 28, 2016 at 6:53 pm							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>Very good article Indeed.<br>
I have a query here. How calloc differ from malloc in allocation process ? I mean , Is there any subtle difference between these two except its no. of arguments and zero initialization ?</p>
<p id="comment-like-464" data-liked="comment-not-liked" class="comment-likes comment-not-liked"><a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?like_comment=464&amp;_wpnonce=a477c4ef93" class="comment-like-link needs-login" rel="nofollow" data-blog="84729955"><span>Like</span></a><span id="comment-like-count-464" class="comment-like-feedback">Like</span></p>
				</div><!-- .comment-content -->

				<div class="reply"><a rel="nofollow" class="comment-reply-link" href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?replytocom=464#respond" onclick="return addComment.moveForm( &quot;div-comment-464&quot;, &quot;464&quot;, &quot;respond&quot;, &quot;3&quot; )" aria-label="Reply to Kush">Reply</a></div>			</article><!-- .comment-body -->
<ul class="children">
		<li id="comment-544" class="comment odd alt depth-2 highlander-comment">
			<article id="div-comment-544" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt="" src="./Understanding glibc malloc – sploitF-U-N_files/6e8881245aec6dc302b647bda91a45da" class="avatar avatar-50 grav-hashed grav-hijack" height="50" width="50" id="grav-6e8881245aec6dc302b647bda91a45da-1">						<b class="fn">S. Rahul</b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/#comment-544">
							<time datetime="2017-02-13T10:42:59+00:00">
								February 13, 2017 at 10:42 am							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>Atleast in the case of glibc calloc functionality there would not be any difference as it just calls relevant “malloc” routine to allocate memory and does memset.</p>
<p id="comment-like-544" data-liked="comment-not-liked" class="comment-likes comment-not-liked"><a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?like_comment=544&amp;_wpnonce=e42e4b0122" class="comment-like-link needs-login" rel="nofollow" data-blog="84729955"><span>Like</span></a><span id="comment-like-count-544" class="comment-like-feedback">Like</span></p>
				</div><!-- .comment-content -->

				<div class="reply"><a rel="nofollow" class="comment-reply-link" href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?replytocom=544#respond" onclick="return addComment.moveForm( &quot;div-comment-544&quot;, &quot;544&quot;, &quot;respond&quot;, &quot;3&quot; )" aria-label="Reply to S. Rahul">Reply</a></div>			</article><!-- .comment-body -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
		<li id="comment-513" class="comment even thread-even depth-1 highlander-comment">
			<article id="div-comment-513" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt="" src="./Understanding glibc malloc – sploitF-U-N_files/picture(1)" class="avatar avatar-50" height="50" width="50">						<b class="fn"><a href="https://www.facebook.com/app_scoped_user_id/183128362115485/" rel="external nofollow" class="url">Jack Cluts</a></b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/#comment-513">
							<time datetime="2017-01-08T10:04:46+00:00">
								January 8, 2017 at 10:04 am							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>Super post! Thanks for the info , saved me a lot of time looking around the web.</p>
<p id="comment-like-513" data-liked="comment-not-liked" class="comment-likes comment-not-liked"><a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?like_comment=513&amp;_wpnonce=abd4940b38" class="comment-like-link needs-login" rel="nofollow" data-blog="84729955"><span>Like</span></a><span id="comment-like-count-513" class="comment-like-feedback">Like</span></p>
				</div><!-- .comment-content -->

				<div class="reply"><a rel="nofollow" class="comment-reply-link" href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?replytocom=513#respond" onclick="return addComment.moveForm( &quot;div-comment-513&quot;, &quot;513&quot;, &quot;respond&quot;, &quot;3&quot; )" aria-label="Reply to Jack Cluts">Reply</a></div>			</article><!-- .comment-body -->
</li><!-- #comment-## -->
		<li id="comment-536" class="comment odd alt thread-odd thread-alt depth-1 highlander-comment">
			<article id="div-comment-536" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt="" src="./Understanding glibc malloc – sploitF-U-N_files/fd1d59ef31ddbaf3a74f37ea663d5fb9" class="avatar avatar-50 grav-hashed grav-hijack" height="50" width="50" id="grav-fd1d59ef31ddbaf3a74f37ea663d5fb9-0">						<b class="fn">kim</b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/#comment-536">
							<time datetime="2017-02-04T12:55:11+00:00">
								February 4, 2017 at 12:55 pm							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>glibc how to know heap memory or process vmap which is kernel started process  by load_elf_binary() in linux</p>
<p id="comment-like-536" data-liked="comment-not-liked" class="comment-likes comment-not-liked"><a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?like_comment=536&amp;_wpnonce=100ca84f97" class="comment-like-link needs-login" rel="nofollow" data-blog="84729955"><span>Like</span></a><span id="comment-like-count-536" class="comment-like-feedback">Like</span></p>
				</div><!-- .comment-content -->

				<div class="reply"><a rel="nofollow" class="comment-reply-link" href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?replytocom=536#respond" onclick="return addComment.moveForm( &quot;div-comment-536&quot;, &quot;536&quot;, &quot;respond&quot;, &quot;3&quot; )" aria-label="Reply to kim">Reply</a></div>			</article><!-- .comment-body -->
</li><!-- #comment-## -->
		<li id="comment-572" class="comment even thread-even depth-1 highlander-comment">
			<article id="div-comment-572" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt="" src="./Understanding glibc malloc – sploitF-U-N_files/318f6573e498e0d4e02e47a48ce91242" class="avatar avatar-50 grav-hashed grav-hijack" height="50" width="50" id="grav-318f6573e498e0d4e02e47a48ce91242-0">						<b class="fn">Haijun Wang</b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/#comment-572">
							<time datetime="2017-03-21T15:37:51+00:00">
								March 21, 2017 at 3:37 pm							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>I have two questions about the unsorted, small and large Bin snapshot:<br>
1. At the block which has the address 0x804b3a8, we can obtain fd=0xb7fd8430, but why is its linked address is 0xb7fd8438?<br>
2. The type of Bins is an array of pointers of malloc_chunk, but the type of fd is the pointer of malloc_chunk. why can fd point to an element of Bins?</p>
<p id="comment-like-572" data-liked="comment-not-liked" class="comment-likes comment-not-liked"><a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?like_comment=572&amp;_wpnonce=e1201c82e8" class="comment-like-link needs-login" rel="nofollow" data-blog="84729955"><span>Like</span></a><span id="comment-like-count-572" class="comment-like-feedback">Like</span></p>
				</div><!-- .comment-content -->

				<div class="reply"><a rel="nofollow" class="comment-reply-link" href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?replytocom=572#respond" onclick="return addComment.moveForm( &quot;div-comment-572&quot;, &quot;572&quot;, &quot;respond&quot;, &quot;3&quot; )" aria-label="Reply to Haijun Wang">Reply</a></div>			</article><!-- .comment-body -->
</li><!-- #comment-## -->
		<li id="comment-585" class="pingback odd alt thread-odd thread-alt depth-1 highlander-comment">
			<article id="div-comment-585" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
												<b class="fn"><a href="https://team-nawhack.fr/2017/04/17/picoctf-2017-enter-the-matrix/" rel="external nofollow" class="url">PicoCTF 2017 – Enter The Matrix – Nawhack</a></b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/#comment-585">
							<time datetime="2017-04-17T07:49:12+00:00">
								April 17, 2017 at 7:49 am							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>[…] <a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/" rel="nofollow">https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/</a> […]</p>
<p id="comment-like-585" data-liked="comment-not-liked" class="comment-likes comment-not-liked"><a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?like_comment=585&amp;_wpnonce=d06339a249" class="comment-like-link needs-login" rel="nofollow" data-blog="84729955"><span>Like</span></a><span id="comment-like-count-585" class="comment-like-feedback">Like</span></p>
				</div><!-- .comment-content -->

				<div class="reply"><a rel="nofollow" class="comment-reply-link" href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?replytocom=585#respond" onclick="return addComment.moveForm( &quot;div-comment-585&quot;, &quot;585&quot;, &quot;respond&quot;, &quot;3&quot; )" aria-label="Reply to PicoCTF 2017 – Enter The Matrix – Nawhack">Reply</a></div>			</article><!-- .comment-body -->
</li><!-- #comment-## -->
		<li id="comment-593" class="pingback even thread-even depth-1 highlander-comment">
			<article id="div-comment-593" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
												<b class="fn"><a href="https://team-nawhack.fr/2017/04/25/bctf-2017-babyuse/" rel="external nofollow" class="url">BCTF – 2017 – Babyuse – Nawhack</a></b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/#comment-593">
							<time datetime="2017-04-25T19:11:08+00:00">
								April 25, 2017 at 7:11 pm							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>[…] <a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/" rel="nofollow">https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/</a> […]</p>
<p id="comment-like-593" data-liked="comment-not-liked" class="comment-likes comment-not-liked"><a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?like_comment=593&amp;_wpnonce=c8c14983c9" class="comment-like-link needs-login" rel="nofollow" data-blog="84729955"><span>Like</span></a><span id="comment-like-count-593" class="comment-like-feedback">Like</span></p>
				</div><!-- .comment-content -->

				<div class="reply"><a rel="nofollow" class="comment-reply-link" href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?replytocom=593#respond" onclick="return addComment.moveForm( &quot;div-comment-593&quot;, &quot;593&quot;, &quot;respond&quot;, &quot;3&quot; )" aria-label="Reply to BCTF – 2017 – Babyuse – Nawhack">Reply</a></div>			</article><!-- .comment-body -->
</li><!-- #comment-## -->
		<li id="comment-594" class="pingback odd alt thread-odd thread-alt depth-1 highlander-comment">
			<article id="div-comment-594" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
												<b class="fn"><a href="http://www.heikuo.net/3496.html" rel="external nofollow" class="url">PWN之堆内存管理 | 黑阔资讯 ' Blog</a></b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/#comment-594">
							<time datetime="2017-04-26T01:34:42+00:00">
								April 26, 2017 at 1:34 am							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>[…] #很多人引用了这篇文章, 关于堆布局的图都是采用这篇文章里的 Understanding glibc malloc #Phrack #这篇文章很值的读, 虽然里面的一些技术不再适用, […]</p>
<p id="comment-like-594" data-liked="comment-not-liked" class="comment-likes comment-not-liked"><a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?like_comment=594&amp;_wpnonce=22ca55b91b" class="comment-like-link needs-login" rel="nofollow" data-blog="84729955"><span>Like</span></a><span id="comment-like-count-594" class="comment-like-feedback">Like</span></p>
				</div><!-- .comment-content -->

				<div class="reply"><a rel="nofollow" class="comment-reply-link" href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?replytocom=594#respond" onclick="return addComment.moveForm( &quot;div-comment-594&quot;, &quot;594&quot;, &quot;respond&quot;, &quot;3&quot; )" aria-label="Reply to PWN之堆内存管理 | 黑阔资讯 &#39; Blog">Reply</a></div>			</article><!-- .comment-body -->
</li><!-- #comment-## -->
		<li id="comment-644" class="comment byuser comment-author-shahril96 even thread-even depth-1 highlander-comment">
			<article id="div-comment-644" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt="" src="./Understanding glibc malloc – sploitF-U-N_files/a8cc1bd42843e81129f74bf4c43ca0fe.png" class="avatar avatar-50 grav-hashed grav-hijack" height="50" width="50" id="grav-a8cc1bd42843e81129f74bf4c43ca0fe-0">						<b class="fn"><a href="http://mohdshahril.my/" rel="external nofollow" class="url">shahril96</a></b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/#comment-644">
							<time datetime="2017-05-14T10:12:07+00:00">
								May 14, 2017 at 10:12 am							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>Hi, thanks for the explanation, it really helps!</p>
<p>Can I know what is the meaning of `consolidate` in the context of Glibc malloc? I can’t understand it while you’re explaining it and I usually mixed up<br>
the term with coelesce. </p>
<p>From my understanding, when there are few free chunks in the unsorted bin, the malloc internal code will consolidate (combine) the free chunks and will<br>
add it to the next small or large bins. But this is a coalesce process right?</p>
<p>definitions of:<br>
1) coalesce = combine (elements) in a mass or whole.<br>
2) consolidate = combine (a number of things) into a single more effective or coherent whole.</p>
<p>Both of these have the “combine” word there, which confused me a lot!</p>
<p id="comment-like-644" data-liked="comment-not-liked" class="comment-likes comment-not-liked"><a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?like_comment=644&amp;_wpnonce=ef33493f0e" class="comment-like-link needs-login" rel="nofollow" data-blog="84729955"><span>Like</span></a><span id="comment-like-count-644" class="comment-like-feedback">Liked by <a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/#" class="view-likers" data-like-count="1">1 person</a></span></p>
				</div><!-- .comment-content -->

				<div class="reply"><a rel="nofollow" class="comment-reply-link" href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/?replytocom=644#respond" onclick="return addComment.moveForm( &quot;div-comment-644&quot;, &quot;644&quot;, &quot;respond&quot;, &quot;3&quot; )" aria-label="Reply to shahril96">Reply</a></div>			</article><!-- .comment-body -->
</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		
	
	
		<div id="respond" class="comment-respond js">
		<h3 id="reply-title" class="comment-reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/#respond" style="display:none;">Cancel reply</a></small></h3>			<form action="https://sploitfun.wordpress.com/wp-comments-post.php" method="post" id="commentform" class="comment-form" novalidate="">
				<input type="hidden" id="highlander_comment_nonce" name="highlander_comment_nonce" value="b86d7a100f"><input type="hidden" name="_wp_http_referer" value="/2015/02/10/understanding-glibc-malloc/">
<input type="hidden" name="hc_post_as" id="hc_post_as" value="guest">

<div class="comment-form-field comment-textarea">
	
	<div id="comment-form-comment"><textarea tabindex="-1" style="position: absolute; top: -999px; left: 0px; right: auto; bottom: auto; border: 0px; padding: 0px; box-sizing: content-box; word-wrap: break-word; overflow: hidden; transition: none; height: 0px !important; min-height: 0px !important; font-family: Arial, Helvetica, Tahoma, Verdana, sans-serif; font-size: 14px; font-weight: 400; font-style: normal; letter-spacing: 0px; text-transform: none; text-decoration: none solid rgba(0, 0, 0, 0.7); word-spacing: 0px; text-indent: 0px; line-height: 21px; width: 650px;" class="autosizejs "></textarea><textarea id="comment" name="comment" title="Enter your comment here..." placeholder="Enter your comment here..." style="height: 41px; overflow: hidden; word-wrap: break-word; resize: none;"></textarea></div>
</div>

<div id="comment-form-identity" style="display: none;">
	<div id="comment-form-nascar">
		<p>Fill in your details below or click an icon to log in:</p>
		<ul>
			<li class="selected" style="display:none;">
				<a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/#comment-form-guest" id="postas-guest" class="nascar-signin-link" title="Login via Guest">
									</a>
			</li>
			<li>
				<a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/#comment-form-load-service:WordPress.com" id="postas-wordpress" class="nascar-signin-link" title="Login via WordPress.com">
					<svg xmlns="http://www.w3.org/2000/svg" role="presentation" viewBox="0 0 24 24"><rect x="0" fill="none" width="24" height="24"></rect><g><path fill="#0087be" d="M12.158 12.786l-2.698 7.84c.806.236 1.657.365 2.54.365 1.047 0 2.05-.18 2.986-.51-.024-.037-.046-.078-.065-.123l-2.762-7.57zM3.008 12c0 3.56 2.07 6.634 5.068 8.092L3.788 8.342c-.5 1.117-.78 2.354-.78 3.658zm15.06-.454c0-1.112-.398-1.88-.74-2.48-.456-.74-.883-1.368-.883-2.11 0-.825.627-1.595 1.51-1.595.04 0 .078.006.116.008-1.598-1.464-3.73-2.36-6.07-2.36-3.14 0-5.904 1.613-7.512 4.053.21.008.41.012.58.012.94 0 2.395-.114 2.395-.114.484-.028.54.684.057.74 0 0-.487.058-1.03.086l3.275 9.74 1.968-5.902-1.4-3.838c-.485-.028-.944-.085-.944-.085-.486-.03-.43-.77.056-.742 0 0 1.484.114 2.368.114.94 0 2.397-.114 2.397-.114.486-.028.543.684.058.74 0 0-.488.058-1.03.086l3.25 9.665.897-2.997c.456-1.17.684-2.137.684-2.907zm1.82-3.86c.04.286.06.593.06.924 0 .912-.17 1.938-.683 3.22l-2.746 7.94c2.672-1.558 4.47-4.454 4.47-7.77 0-1.564-.4-3.033-1.1-4.314zM12 22C6.486 22 2 17.514 2 12S6.486 2 12 2s10 4.486 10 10-4.486 10-10 10z"></path></g></svg>				</a>
			</li>
			<li>
			<iframe id="googleplus-sign-in" name="googleplus-sign-in" src="./Understanding glibc malloc – sploitF-U-N_files/saved_resource(14).html" width="24" height="24" scrolling="no" allowtransparency="true" seamless="seamless" frameborder="0"></iframe>
			</li>
			<li>
				<a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/#comment-form-load-service:Twitter" id="postas-twitter" class="nascar-signin-link" title="Login via Twitter">
					<svg xmlns="http://www.w3.org/2000/svg" role="presentation" viewBox="0 0 24 24"><rect x="0" fill="none" width="24" height="24"></rect><g><path fill="#1DA1F2" d="M22.23 5.924c-.736.326-1.527.547-2.357.646.847-.508 1.498-1.312 1.804-2.27-.793.47-1.67.812-2.606.996C18.325 4.498 17.258 4 16.078 4c-2.266 0-4.103 1.837-4.103 4.103 0 .322.036.635.106.935-3.41-.17-6.433-1.804-8.457-4.287-.353.607-.556 1.312-.556 2.064 0 1.424.724 2.68 1.825 3.415-.673-.022-1.305-.207-1.86-.514v.052c0 1.988 1.415 3.647 3.293 4.023-.344.095-.707.145-1.08.145-.265 0-.522-.026-.773-.074.522 1.63 2.038 2.817 3.833 2.85-1.404 1.1-3.174 1.757-5.096 1.757-.332 0-.66-.02-.98-.057 1.816 1.164 3.973 1.843 6.29 1.843 7.547 0 11.675-6.252 11.675-11.675 0-.178-.004-.355-.012-.53.802-.578 1.497-1.3 2.047-2.124z"></path></g></svg>				</a>
			</li>
			<li>
				<a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/#comment-form-load-service:Facebook" id="postas-facebook" class="nascar-signin-link" title="Login via Facebook">
					<svg xmlns="http://www.w3.org/2000/svg" role="presentation" viewBox="0 0 24 24"><rect x="0" fill="none" width="24" height="24"></rect><g><path fill="#3B5998" d="M20.007 3H3.993C3.445 3 3 3.445 3 3.993v16.013c0 .55.445.994.993.994h8.62v-6.97H10.27V11.31h2.346V9.31c0-2.325 1.42-3.59 3.494-3.59.993 0 1.847.073 2.096.106v2.43h-1.438c-1.128 0-1.346.537-1.346 1.324v1.734h2.69l-.35 2.717h-2.34V21h4.587c.548 0 .993-.445.993-.993V3.993c0-.548-.445-.993-.993-.993z"></path></g></svg>				</a>
			</li>
		</ul>
	</div>

	<div id="comment-form-guest" class="comment-form-service selected">
		<div class="comment-form-padder">
			<div class="comment-form-avatar">
<a href="https://gravatar.com/site/signup/" target="_blank">				<img src="./Understanding glibc malloc – sploitF-U-N_files/ad516503a11cd5ca435acc9bb6523536" alt="Gravatar" width="25" class="no-grav">
</a>			</div>

				<div class="comment-form-fields">
				<div class="comment-form-field comment-form-email">
					<label for="email">Email <span class="required">(required)</span> <span class="nopublish">(Address never made public)</span></label>
					<div class="comment-form-input"><input id="email" name="email" type="email" value=""></div>
				</div>
				<div class="comment-form-field comment-form-author">
					<label for="author">Name <span class="required">(required)</span></label>
					<div class="comment-form-input"><input id="author" name="author" type="text" value=""></div>
				</div>
				<div class="comment-form-field comment-form-url">
					<label for="url">Website</label>
					<div class="comment-form-input"><input id="url" name="url" type="url" value=""></div>
				</div>
			</div>
	
		</div>
	</div>

	<div id="comment-form-wordpress" class="comment-form-service">
		<div class="comment-form-padder">
			<div class="comment-form-avatar">
				<img src="./Understanding glibc malloc – sploitF-U-N_files/ad516503a11cd5ca435acc9bb6523536" alt="WordPress.com Logo" width="25" class="no-grav">
			</div>

				<div class="comment-form-fields">
				<input type="hidden" name="wp_avatar" id="wordpress-avatar" class="comment-meta-wordpress" value="">
				<input type="hidden" name="wp_user_id" id="wordpress-user_id" class="comment-meta-wordpress" value="">
				<input type="hidden" name="wp_access_token" id="wordpress-access_token" class="comment-meta-wordpress" value="">
						<p class="comment-form-posting-as pa-wordpress">
			<strong></strong>
			You are commenting using your <span class="skimlinks-unlinked">WordPress.com</span> account.			<span class="comment-form-log-out">
				(&nbsp;<a href="javascript:HighlanderComments.doExternalLogout( &#39;wordpress&#39; );">Log&nbsp;Out</a>&nbsp;/&nbsp;
				<a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/#" onclick="javascript:HighlanderComments.switchAccount();return false;">Change</a>&nbsp;)
			</span>
			<span class="pa-icon"><svg xmlns="http://www.w3.org/2000/svg" role="presentation" viewBox="0 0 24 24"><rect x="0" fill="none" width="24" height="24"></rect><g><path fill="#0087be" d="M12.158 12.786l-2.698 7.84c.806.236 1.657.365 2.54.365 1.047 0 2.05-.18 2.986-.51-.024-.037-.046-.078-.065-.123l-2.762-7.57zM3.008 12c0 3.56 2.07 6.634 5.068 8.092L3.788 8.342c-.5 1.117-.78 2.354-.78 3.658zm15.06-.454c0-1.112-.398-1.88-.74-2.48-.456-.74-.883-1.368-.883-2.11 0-.825.627-1.595 1.51-1.595.04 0 .078.006.116.008-1.598-1.464-3.73-2.36-6.07-2.36-3.14 0-5.904 1.613-7.512 4.053.21.008.41.012.58.012.94 0 2.395-.114 2.395-.114.484-.028.54.684.057.74 0 0-.487.058-1.03.086l3.275 9.74 1.968-5.902-1.4-3.838c-.485-.028-.944-.085-.944-.085-.486-.03-.43-.77.056-.742 0 0 1.484.114 2.368.114.94 0 2.397-.114 2.397-.114.486-.028.543.684.058.74 0 0-.488.058-1.03.086l3.25 9.665.897-2.997c.456-1.17.684-2.137.684-2.907zm1.82-3.86c.04.286.06.593.06.924 0 .912-.17 1.938-.683 3.22l-2.746 7.94c2.672-1.558 4.47-4.454 4.47-7.77 0-1.564-.4-3.033-1.1-4.314zM12 22C6.486 22 2 17.514 2 12S6.486 2 12 2s10 4.486 10 10-4.486 10-10 10z"></path></g></svg></span>
		</p>
					</div>
	
		</div>
	</div>

	<div id="comment-form-googleplus" class="comment-form-service">
		<div class="comment-form-padder">
			<div class="comment-form-avatar">
				<img src="./Understanding glibc malloc – sploitF-U-N_files/ad516503a11cd5ca435acc9bb6523536" alt="Google+ photo" width="25" class="no-grav">
			</div>

				<div class="comment-form-fields">
				<input type="hidden" name="googleplus_avatar" id="googleplus-avatar" class="comment-meta-googleplus" value="">
				<input type="hidden" name="googleplus_user_id" id="googleplus-user_id" class="comment-meta-googleplus" value="">
				<input type="hidden" name="googleplus_access_token" id="googleplus-access_token" class="comment-meta-googleplus" value="">
						<p class="comment-form-posting-as pa-googleplus">
			<strong></strong>
			You are commenting using your Google+ account.			<span class="comment-form-log-out">
				(&nbsp;<a href="javascript:HighlanderComments.doExternalLogout( &#39;googleplus&#39; );">Log&nbsp;Out</a>&nbsp;/&nbsp;
				<a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/#" onclick="javascript:HighlanderComments.switchAccount();return false;">Change</a>&nbsp;)
			</span>
			<span class="pa-icon"><svg xmlns="http://www.w3.org/2000/svg" role="presentation" x="0px" y="0px" viewBox="0 0 60 60"><path fill="#519bf7" d="M56.3,30c0,-1.6 -0.2,-3.4 -0.6,-5h-3.1H42.2H30v10.6h14.8C44,39.3 42,42 39.1,43.9l8.8,6.8C53,46 56.3,39 56.3,30z"></path><path fill="#3db366" d="M30,57.5c6.7,0 13.1,-2.4 17.9,-6.8l-8.8,-6.8c-2.5,1.6 -5.6,2.4 -9.1,2.4c-7.2,0 -13.3,-4.7 -15.4,-11.2l-9.3,7.1C9.8,51.3 19.1,57.5 30,57.5z"></path><path fill="#fdc600" d="M5.3,42.2l9.3,-7.1c-0.5,-1.6 -0.8,-3.3 -0.8,-5.1s0.3,-3.5 0.8,-5.1l-9.3,-7.1C3.5,21.5 2.5,25.6 2.5,30S3.5,38.5 5.3,42.2z"></path><path fill="#f15b44" d="M40.1,17.4l8,-8C43.3,5.1 37,2.5 30,2.5C19.1,2.5 9.8,8.7 5.3,17.8l9.3,7.1c2.1,-6.5 8.2,-11.1 15.4,-11.1C33.9,13.7 37.4,15.1 40.1,17.4z"></path></svg></span>
		</p>
					</div>
	
		</div>
	</div>

	<div id="comment-form-twitter" class="comment-form-service">
		<div class="comment-form-padder">
			<div class="comment-form-avatar">
				<img src="./Understanding glibc malloc – sploitF-U-N_files/ad516503a11cd5ca435acc9bb6523536" alt="Twitter picture" width="25" class="no-grav">
			</div>

				<div class="comment-form-fields">
				<input type="hidden" name="twitter_avatar" id="twitter-avatar" class="comment-meta-twitter" value="">
				<input type="hidden" name="twitter_user_id" id="twitter-user_id" class="comment-meta-twitter" value="">
				<input type="hidden" name="twitter_access_token" id="twitter-access_token" class="comment-meta-twitter" value="">
						<p class="comment-form-posting-as pa-twitter">
			<strong></strong>
			You are commenting using your Twitter account.			<span class="comment-form-log-out">
				(&nbsp;<a href="javascript:HighlanderComments.doExternalLogout( &#39;twitter&#39; );">Log&nbsp;Out</a>&nbsp;/&nbsp;
				<a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/#" onclick="javascript:HighlanderComments.switchAccount();return false;">Change</a>&nbsp;)
			</span>
			<span class="pa-icon"><svg xmlns="http://www.w3.org/2000/svg" role="presentation" viewBox="0 0 24 24"><rect x="0" fill="none" width="24" height="24"></rect><g><path fill="#1DA1F2" d="M22.23 5.924c-.736.326-1.527.547-2.357.646.847-.508 1.498-1.312 1.804-2.27-.793.47-1.67.812-2.606.996C18.325 4.498 17.258 4 16.078 4c-2.266 0-4.103 1.837-4.103 4.103 0 .322.036.635.106.935-3.41-.17-6.433-1.804-8.457-4.287-.353.607-.556 1.312-.556 2.064 0 1.424.724 2.68 1.825 3.415-.673-.022-1.305-.207-1.86-.514v.052c0 1.988 1.415 3.647 3.293 4.023-.344.095-.707.145-1.08.145-.265 0-.522-.026-.773-.074.522 1.63 2.038 2.817 3.833 2.85-1.404 1.1-3.174 1.757-5.096 1.757-.332 0-.66-.02-.98-.057 1.816 1.164 3.973 1.843 6.29 1.843 7.547 0 11.675-6.252 11.675-11.675 0-.178-.004-.355-.012-.53.802-.578 1.497-1.3 2.047-2.124z"></path></g></svg></span>
		</p>
					</div>
	
		</div>
	</div>

	<div id="comment-form-facebook" class="comment-form-service">
		<div class="comment-form-padder">
			<div class="comment-form-avatar">
				<img src="./Understanding glibc malloc – sploitF-U-N_files/ad516503a11cd5ca435acc9bb6523536" alt="Facebook photo" width="25" class="no-grav">
			</div>

				<div class="comment-form-fields">
				<input type="hidden" name="fb_avatar" id="facebook-avatar" class="comment-meta-facebook" value="">
				<input type="hidden" name="fb_user_id" id="facebook-user_id" class="comment-meta-facebook" value="">
				<input type="hidden" name="fb_access_token" id="facebook-access_token" class="comment-meta-facebook" value="">
						<p class="comment-form-posting-as pa-facebook">
			<strong></strong>
			You are commenting using your Facebook account.			<span class="comment-form-log-out">
				(&nbsp;<a href="javascript:HighlanderComments.doExternalLogout( &#39;facebook&#39; );">Log&nbsp;Out</a>&nbsp;/&nbsp;
				<a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/#" onclick="javascript:HighlanderComments.switchAccount();return false;">Change</a>&nbsp;)
			</span>
			<span class="pa-icon"><svg xmlns="http://www.w3.org/2000/svg" role="presentation" viewBox="0 0 24 24"><rect x="0" fill="none" width="24" height="24"></rect><g><path fill="#3B5998" d="M20.007 3H3.993C3.445 3 3 3.445 3 3.993v16.013c0 .55.445.994.993.994h8.62v-6.97H10.27V11.31h2.346V9.31c0-2.325 1.42-3.59 3.494-3.59.993 0 1.847.073 2.096.106v2.43h-1.438c-1.128 0-1.346.537-1.346 1.324v1.734h2.69l-.35 2.717h-2.34V21h4.587c.548 0 .993-.445.993-.993V3.993c0-.548-.445-.993-.993-.993z"></path></g></svg></span>
		</p>
		w
			</div>
	
		</div>
	</div>


	<div id="comment-form-load-service" class="comment-form-service">
		<div class="comment-form-posting-as-cancel"><a href="javascript:HighlanderComments.cancelExternalWindow();">Cancel</a></div>
		<p>Connecting to %s</p>
	</div>

</div>

<script type="text/javascript">
var highlander_expando_javascript = function(){
	var input = document.createElement( 'input' ),
	    comment = jQuery( '#comment' );

	if ( 'placeholder' in input ) {
		comment.attr( 'placeholder', jQuery( '.comment-textarea label' ).remove().text() );
	}

	// Expando Mode: start small, then auto-resize on first click + text length
	jQuery( '#comment-form-identity' ).hide();
	jQuery( '#comment-form-subscribe' ).hide();
	jQuery( '#commentform .form-submit' ).hide();

	comment.css( { 'height':'10px' } ).one( 'focus', function() {
		var timer = setInterval( HighlanderComments.resizeCallback, 10 )
		jQuery( this ).animate( { 'height': HighlanderComments.initialHeight } ).delay( 100 ).queue( function(n) { clearInterval( timer ); HighlanderComments.resizeCallback(); n(); } );
		jQuery( '#comment-form-identity' ).slideDown();
		jQuery( '#comment-form-subscribe' ).slideDown();
		jQuery( '#commentform .form-submit' ).slideDown();
	});
}
jQuery(document).ready( highlander_expando_javascript );
</script>

<div id="comment-form-subscribe" style="display: none;">
	<p class="comment-subscription-form"><input type="checkbox" name="subscribe" id="subscribe" value="subscribe" style="width: auto;"> <label class="subscribe-label" id="subscribe-label" for="subscribe" style="display: inline;">Notify me of new comments via email.</label></p></div>




<p class="form-submit" style="display: none;"><input name="submit" type="submit" id="comment-submit" class="submit" value="Post Comment"> <input type="hidden" name="comment_post_ID" value="3" id="comment_post_ID">
<input type="hidden" name="comment_parent" id="comment_parent" value="0">
</p><p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="bd40ce4ed4"></p>
<input type="hidden" name="genseq" value="1527473571">
<p style="display: none;"></p>			<input type="hidden" id="ak_js" name="ak_js" value="1527473574395"></form>
			</div><!-- #respond -->
	<div style="clear: both"></div>
</div><!-- #comments -->

		
		</main><!-- #main -->
	</div><!-- #primary -->

	<div id="secondary" class="widget-areas clear" role="complementary">
		<div class="widget-areas-inner">
										<div class="widget-area">
					<aside id="follow_button_widget-3" class="widget widget_follow_button_widget">
		<iframe src="./Understanding glibc malloc – sploitF-U-N_files/index(1).html" width="100%" height="20" frameborder="0" scrolling="no"></iframe>
		<script type="text/javascript">(function(d){var f = d.getElementsByTagName('SCRIPT')[0], p = d.createElement('SCRIPT');p.type = 'text/javascript';p.async = true;p.src = '//widgets.wp.com/platform.js';f.parentNode.insertBefore(p,f);}(document));</script>

		</aside>				</div>
										<div class="widget-area">
					<aside id="blog_subscription-4" class="widget widget_blog_subscription"><h1 class="widget-title"><label for="subscribe-field">Follow Blog via Email</label></h1>
				<form action="https://subscribe.wordpress.com/" method="post" accept-charset="utf-8" id="subscribe-blog">
											<p>Enter your email address to follow this blog and receive notifications of new posts by email.</p>
<p>Join 109 other followers</p>
						<p><input type="text" name="email" style="width: 95%; padding: 1px 2px" placeholder="Enter your email address" value="" id="subscribe-field"></p>
					
					<p>
						<input type="hidden" name="action" value="subscribe">
						<input type="hidden" name="blog_id" value="84729955">
						<input type="hidden" name="source" value="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/">
						<input type="hidden" name="sub-type" value="widget">
						<input type="hidden" name="redirect_fragment" value="blog_subscription-4">
						<input type="hidden" id="_wpnonce" name="_wpnonce" value="73bc81d1a0">						<input type="submit" value="Follow">
					</p>
				</form>
			
</aside>				</div>
								</div>
	</div><!-- #secondary -->
	</div><!-- #content -->

	<footer id="colophon" class="site-footer" role="contentinfo">
		<div class="site-info">
						<a href="https://wordpress.com/?ref=footer_blog">Blog at WordPress.com.</a>
			
					</div><!-- .site-info -->
	</footer><!-- #colophon -->
</div><!-- #page -->

<!--  -->
<script type="text/javascript" src="./Understanding glibc malloc – sploitF-U-N_files/gprofiles.js.下载"></script>
<script type="text/javascript">
/* <![CDATA[ */
var WPGroHo = {"my_hash":""};
/* ]]> */
</script>
<script type="text/javascript" src="./Understanding glibc malloc – sploitF-U-N_files/wpgroho.js.下载"></script>

	<script>
		//initialize and attach hovercards to all gravatars
		jQuery( document ).ready( function( $ ) {

			if (typeof Gravatar === "undefined"){
				return;
			}

			if ( typeof Gravatar.init !== "function" ) {
				return;
			}			

			Gravatar.profile_cb = function( hash, id ) {
				WPGroHo.syncProfileData( hash, id );
			};
			Gravatar.my_hash = WPGroHo.my_hash;
			Gravatar.init( 'body', '#wp-admin-bar-my-account' );
		});
	</script>

		<div style="display:none">
	<div class="grofile-hash-map-5c2888084ed6ac4c1c6e71cbd6bd23a4">
	</div>
	<div class="grofile-hash-map-7faebbbda48a4e89777919430e5b9766">
	</div>
	<div class="grofile-hash-map-f4b4036422c8f698d2a477c874fb9c6f">
	</div>
	<div class="grofile-hash-map-879ea09b37cde0743badd59f81fa918f">
	</div>
	<div class="grofile-hash-map-7ee111df8bebd34d31c4f096458de1c1">
	</div>
	<div class="grofile-hash-map-6e8881245aec6dc302b647bda91a45da">
	</div>
	<div class="grofile-hash-map-43fbdb7a0dfc74fb17ed1dc08883f6ee">
	</div>
	<div class="grofile-hash-map-d390f3408cbd5735f88ef0c4f7e1dab8">
	</div>
	<div class="grofile-hash-map-437927767c6e4e01cb6f4f5b027ddd9f">
	</div>
	<div class="grofile-hash-map-ab0f4abc324a9bf4ab632c4273a1bc59">
	</div>
	<div class="grofile-hash-map-d72d43904f6fa91394298ada10f77115">
	</div>
	<div class="grofile-hash-map-3200856455b08e044975e0c8755fd354">
	</div>
	<div class="grofile-hash-map-a0675c9b3361594028575d0135d534c3">
	</div>
	<div class="grofile-hash-map-8d430d83cda7fbdbee1f862388c561ac">
	</div>
	<div class="grofile-hash-map-8d430d83cda7fbdbee1f862388c561ac">
	</div>
	<div class="grofile-hash-map-ad16ad8ec932281b1427583640932579">
	</div>
	<div class="grofile-hash-map-280f113b2365bcddf0db7148532e2834">
	</div>
	<div class="grofile-hash-map-a02f2e3d94955937befdbf45d25077cd">
	</div>
	<div class="grofile-hash-map-4b496f565c099c1cfc173e7772402f7f">
	</div>
	<div class="grofile-hash-map-c1a18ca2d27010a9d9bd3f7330924a3e">
	</div>
	<div class="grofile-hash-map-3c3cafb6a0e0c8f4ab1c28fa30291a81">
	</div>
	<div class="grofile-hash-map-0ba7b91182db068a3c110f7becddaf14">
	</div>
	<div class="grofile-hash-map-df3d5f0af640d57506c24e37f3c718c3">
	</div>
	<div class="grofile-hash-map-fd1d59ef31ddbaf3a74f37ea663d5fb9">
	</div>
	<div class="grofile-hash-map-318f6573e498e0d4e02e47a48ce91242">
	</div>
	<div class="grofile-hash-map-a8cc1bd42843e81129f74bf4c43ca0fe">
	</div>
	</div>
<script type="text/javascript">
/* <![CDATA[ */
var HighlanderComments = {"loggingInText":"Logging In\u2026","submittingText":"Posting Comment\u2026","postCommentText":"Post Comment","connectingToText":"Connecting to %s","commentingAsText":"%1$s: You are commenting using your %2$s account.","logoutText":"Log Out","loginText":"Log In","connectURL":"https:\/\/sploitfun.wordpress.com\/public.api\/connect\/?action=request","logoutURL":"https:\/\/sploitfun.wordpress.com\/wp-login.php?action=logout&_wpnonce=034f0e1d96","homeURL":"https:\/\/sploitfun.wordpress.com\/","postID":"3","gravDefault":"identicon","enterACommentError":"Please enter a comment","enterEmailError":"Please enter your email address here","invalidEmailError":"Invalid email address","enterAuthorError":"Please enter your name here","gravatarFromEmail":"This picture will show whenever you leave a comment. Click to customize it.","logInToExternalAccount":"Log in to use details from one of these accounts.","change":"Change","changeAccount":"Change Account","comment_registration":"0","userIsLoggedIn":"","isJetpack":"","text_direction":"ltr"};
/* ]]> */
</script>
<script type="text/javascript" src="./Understanding glibc malloc – sploitF-U-N_files/saved_resource(6)"></script>

	<script type="text/javascript">
		window.WPCOM_sharing_counts = {"https:\/\/sploitfun.wordpress.com\/2015\/02\/10\/understanding-glibc-malloc\/":3};
	</script>
<script type="text/javascript">
/* <![CDATA[ */
var comment_like_text = {"loading":"Loading..."};
/* ]]> */
</script>
<script type="text/javascript">
/* <![CDATA[ */
var actionbardata = {"siteID":"84729955","siteName":"sploitF-U-N","siteURL":"http:\/\/sploitfun.wordpress.com","icon":"<img alt='' src='https:\/\/s2.wp.com\/i\/logo\/wpcom-gray-white.png' class='avatar avatar-50' height='50' width='50' \/>","canManageOptions":"","canCustomizeSite":"","isFollowing":"","themeSlug":"pub\/kelly","signupURL":"https:\/\/wordpress.com\/start\/","loginURL":"https:\/\/sploitfun.wordpress.com\/wp-login.php?redirect_to=https%3A%2F%2Fsploitfun.wordpress.com%2F2015%2F02%2F10%2Funderstanding-glibc-malloc%2F","themeURL":"","xhrURL":"https:\/\/sploitfun.wordpress.com\/wp-admin\/admin-ajax.php","nonce":"d720d2244b","isSingular":"1","isFolded":"","isLoggedIn":"","isMobile":"","subscribeNonce":"<input type=\"hidden\" id=\"_wpnonce\" name=\"_wpnonce\" value=\"73bc81d1a0\" \/>","referer":"https:\/\/sploitfun.wordpress.com\/2015\/02\/10\/understanding-glibc-malloc\/","canFollow":"1","feedID":"34778877","statusMessage":"","customizeLink":"https:\/\/sploitfun.wordpress.com\/wp-admin\/customize.php?url=https%3A%2F%2Fsploitfun.wordpress.com%2F2015%2F02%2F10%2Funderstanding-glibc-malloc%2F","postID":"3","shortlink":"https:\/\/wp.me\/p5Jw8b-3","canEditPost":"","editLink":"https:\/\/wordpress.com\/post\/sploitfun.wordpress.com\/3","statsLink":"https:\/\/wordpress.com\/stats\/post\/3\/sploitfun.wordpress.com","i18n":{"view":"View site","follow":"Follow","following":"Following","edit":"Edit","login":"Log in","signup":"Sign up","customize":"Customize","report":"Report this content","themeInfo":"Get theme: Kelly","shortlink":"Copy shortlink","copied":"Copied","followedText":"New posts from this site will now appear in your <a href=\"https:\/\/wordpress.com\/\">Reader<\/a>","foldBar":"Collapse this bar","unfoldBar":"Expand this bar","editSubs":"Manage subscriptions","viewReader":"View site in Reader","viewReadPost":"View post in Reader","subscribe":"Sign me up","enterEmail":"Enter your email address","followers":"Join 109 other followers","alreadyUser":"Already have a WordPress.com account? <a href=\"https:\/\/sploitfun.wordpress.com\/wp-login.php?redirect_to=https%3A%2F%2Fsploitfun.wordpress.com%2F2015%2F02%2F10%2Funderstanding-glibc-malloc%2F\">Log in now.<\/a>","stats":"Stats"}};
/* ]]> */
</script>
<script type="text/javascript">
/* <![CDATA[ */
var sharing_js_options = {"lang":"en","counts":"1"};
/* ]]> */
</script>
<script type="text/javascript" src="./Understanding glibc malloc – sploitF-U-N_files/saved_resource(7)"></script><div class="widget widget_eu_cookie_law_widget" style="display: block;"><div class="hide-on-button ads-active" data-hide-timeout="30" data-consent-expiration="180" id="eu-cookie-law">
	<form method="post">
		<input type="submit" value="Close and accept" class="accept">

		Privacy &amp; Cookies: This site uses cookies. By continuing to use this website, you agree to their use. <br>
To find out more, including how to control cookies, see here:
		<a href="https://automattic.com/cookies">
			Cookie Policy		</a>
 </form>
</div>
</div><div id="actionbar" class="actnbr-pub-kelly actnbr-has-follow actnbr-hidden"><ul><li class="actnbr-btn actnbr-hidden"> 			    	<a class="actnbr-action actnbr-actn-follow" href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/"><svg class="gridicon gridicon__follow" height="24px" width="24px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><g><path d="M23 16v2h-3v3h-2v-3h-3v-2h3v-3h2v3h3zM20 2v9h-4v3h-3v4H4c-1.1 0-2-.9-2-2V2h18zM8 13v-1H4v1h4zm3-3H4v1h7v-1zm0-2H4v1h7V8zm7-4H4v2h14V4z"></path></g></svg><span>Follow</span></a> 			    	<div class="actnbr-popover tip tip-top-left actnbr-notice"> 			    		<div class="tip-arrow"></div> 			    		<div class="tip-inner actnbr-follow-bubble"></div> 			    	</div> 			    </li><li class="actnbr-ellipsis actnbr-hidden"> 			  <svg class="gridicon gridicon__ellipsis" height="24" width="24" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><g><circle cx="5" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="12" cy="12" r="2"></circle></g></svg> 			  <div class="actnbr-popover tip tip-top-left actnbr-more"> 			  	<div class="tip-arrow"></div> 			  	<div class="tip-inner"> 				  <ul> 				    <li class="actnbr-sitename actnbr-hidden"><a href="http://sploitfun.wordpress.com/"><img alt="" src="./Understanding glibc malloc – sploitF-U-N_files/wpcom-gray-white.png" class="avatar avatar-50" height="50" width="50"> sploitF-U-N</a></li> 				   	<li class="actnbr-folded-customize actnbr-hidden"><a href="https://sploitfun.wordpress.com/wp-admin/customize.php?url=https%3A%2F%2Fsploitfun.wordpress.com%2F2015%2F02%2F10%2Funderstanding-glibc-malloc%2F"><svg class="gridicon gridicon__customize" height="20px" width="20px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><g><path d="M2 6c0-1.505.78-3.08 2-4 0 .845.69 2 2 2 1.657 0 3 1.343 3 3 0 .386-.08.752-.212 1.09.74.594 1.476 1.19 2.19 1.81L8.9 11.98c-.62-.716-1.214-1.454-1.807-2.192C6.753 9.92 6.387 10 6 10c-2.21 0-4-1.79-4-4zm12.152 6.848l1.34-1.34c.607.304 1.283.492 2.008.492 2.485 0 4.5-2.015 4.5-4.5 0-.725-.188-1.4-.493-2.007L18 9l-2-2 3.507-3.507C18.9 3.188 18.225 3 17.5 3 15.015 3 13 5.015 13 7.5c0 .725.188 1.4.493 2.007L3 20l2 2 6.848-6.848c1.885 1.928 3.874 3.753 5.977 5.45l1.425 1.148 1.5-1.5-1.15-1.425c-1.695-2.103-3.52-4.092-5.448-5.977z" data-reactid=".2.1.1:0.1b.0"></path></g></svg><span>Customize<span></span></span></a></li> 				    <li class="actnbr-folded-follow actnbr-hidden"><a class="actnbr-action actnbr-actn-follow" href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/"><svg class="gridicon gridicon__follow" height="24px" width="24px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><g><path d="M23 16v2h-3v3h-2v-3h-3v-2h3v-3h2v3h3zM20 2v9h-4v3h-3v4H4c-1.1 0-2-.9-2-2V2h18zM8 13v-1H4v1h4zm3-3H4v1h7v-1zm0-2H4v1h7V8zm7-4H4v2h14V4z"></path></g></svg><span>Follow</span></a></li> 					<li class="actnbr-signup actnbr-hidden"><a href="https://wordpress.com/start/">Sign up</a></li> 				    <li class="actnbr-login actnbr-hidden"><a href="https://sploitfun.wordpress.com/wp-login.php?redirect_to=https%3A%2F%2Fsploitfun.wordpress.com%2F2015%2F02%2F10%2Funderstanding-glibc-malloc%2F">Log in</a></li> 				     				    <li class="actnbr-shortlink actnbr-hidden"><a href="https://wp.me/p5Jw8b-3">Copy shortlink</a></li> 				    <li class="flb-report actnbr-hidden"><a href="http://en.wordpress.com/abuse/">Report this content</a></li> 				     				     				    <li class="actnbr-subs actnbr-hidden"><a href="https://subscribe.wordpress.com/">Manage subscriptions</a></li> 				    <li class="actnbr-fold actnbr-hidden"><a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/">Collapse this bar</a></li> 			      </ul> 			    </div> 		      </div> 		    </li> 	      </ul></div>
<script type="text/javascript">
var windowOpen;
			jQuery( document.body ).on( 'click', 'a.share-twitter', function() {
				// If there's another sharing window open, close it.
				if ( 'undefined' !== typeof windowOpen ) {
					windowOpen.close();
				}
				windowOpen = window.open( jQuery( this ).attr( 'href' ), 'wpcomtwitter', 'menubar=1,resizable=1,width=600,height=350' );
				return false;
			});
var windowOpen;
			jQuery( document.body ).on( 'click', 'a.share-facebook', function() {
				// If there's another sharing window open, close it.
				if ( 'undefined' !== typeof windowOpen ) {
					windowOpen.close();
				}
				windowOpen = window.open( jQuery( this ).attr( 'href' ), 'wpcomfacebook', 'menubar=1,resizable=1,width=600,height=400' );
				return false;
			});
var windowOpen;
			jQuery( document.body ).on( 'click', 'a.share-google-plus-1', function() {
				// If there's another sharing window open, close it.
				if ( 'undefined' !== typeof windowOpen ) {
					windowOpen.close();
				}
				windowOpen = window.open( jQuery( this ).attr( 'href' ), 'wpcomgoogle-plus-1', 'menubar=1,resizable=1,width=480,height=550' );
				return false;
			});
</script>
<script type="text/javascript">
// <![CDATA[
(function() {
try{
  if ( window.external &&'msIsSiteMode' in window.external) {
    if (window.external.msIsSiteMode()) {
      var jl = document.createElement('script');
      jl.type='text/javascript';
      jl.async=true;
      jl.src='/wp-content/plugins/ie-sitemode/custom-jumplist.php';
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(jl, s);
    }
  }
}catch(e){}
})();
// ]]>
</script>	<script type="text/javascript">
	var skimlinks_pub_id = "725X584219"
	var skimlinks_sitename = "sploitfun.wordpress.com";
	</script>
	<script type="text/javascript" defer="" src="./Understanding glibc malloc – sploitF-U-N_files/725X1342.skimlinks.js.下载"></script>		<iframe src="./Understanding glibc malloc – sploitF-U-N_files/master.html" scrolling="no" id="likes-master" name="likes-master" style="display:none;"></iframe>
		<div id="likes-other-gravatars"><div class="likes-text"><span>%d</span> bloggers like this:</div><ul class="wpl-avatars sd-like-gravatars"></ul></div>
<script src="./Understanding glibc malloc – sploitF-U-N_files/w.js.下载" type="text/javascript" async="" defer=""></script>
<script type="text/javascript">
_tkq = window._tkq || [];
_stq = window._stq || [];
_tkq.push(['storeContext', {'blog_id':'84729955','blog_tz':'0','user_lang':'en','blog_lang':'en','user_id':'0'}]);
_stq.push(['view', {'blog':'84729955','v':'wpcom','tz':'0','user_id':'0','post':'3','subd':'sploitfun'}]);
_stq.push(['extra', {'crypt':'UE5XaGUuOTlwaD85flAmcm1mcmZsaDhkV11YdWFnNncxc1tjZG9XVXhRPWclXz01bj9hWHNiXWR6Li9MflNJMjZ0eHdlME4vVGFaMFBEdi1jMi9KRDhMbjksW3R0NVc2MVBfLUtBNFQ3MlYxU01MTDZwfm1dLUNyPz1rTXdMYUhZSjdLOTYuS1c4JlFNRkVfR3AvJjZjMj16eHVXeTFhTURHVHpRWXZHSGx0eHFtPXVtT1Q2JnBdJXNGUXVpcm5uV0xlRU1GSEJVSWVoZ252Jk5XUCwmbzIrMTBoJXFYcnRSX0dZLGR0N11OR0dGU0ZvazJuSHNBd2FxV0FNZzFTTGMlODRabzlaeVhwNHJ2TD1vaHFOemNQJiwuM0otWC9IVg=='}]);
_stq.push([ 'clickTrackerInit', '84729955', '3' ]);
	</script>
<noscript><img src="https://pixel.wp.com/b.gif?v=noscript" style="height:0px;width:0px;overflow:hidden" alt="" /></noscript>
<script>
if ( 'object' === typeof wpcom_mobile_user_agent_info ) {

	wpcom_mobile_user_agent_info.init();
	var mobileStatsQueryString = "";
	
	if( false !== wpcom_mobile_user_agent_info.matchedPlatformName )
		mobileStatsQueryString += "&x_" + 'mobile_platforms' + '=' + wpcom_mobile_user_agent_info.matchedPlatformName;
	
	if( false !== wpcom_mobile_user_agent_info.matchedUserAgentName )
		mobileStatsQueryString += "&x_" + 'mobile_devices' + '=' + wpcom_mobile_user_agent_info.matchedUserAgentName;
	
	if( wpcom_mobile_user_agent_info.isIPad() )
		mobileStatsQueryString += "&x_" + 'ipad_views' + '=' + 'views';

	if( "" != mobileStatsQueryString ) {
		new Image().src = document.location.protocol + '//pixel.wp.com/g.gif?v=wpcom-no-pv' + mobileStatsQueryString + '&baba=' + Math.random();
	}
	
}
</script>

<div class="comment-likes-overlay" style="display: none;"></div><img src="./Understanding glibc malloc – sploitF-U-N_files/g.gif" alt=":)" id="wpstats"><link rel="stylesheet" type="text/css" href="chrome-extension://liecbddmkiiihnedobmlmillhodjkdmb/css/content.css"></body><loom-container id="lo-engage-ext-container"><loom-shadow data-reactroot="" classname="resolved"></loom-shadow></loom-container></html>